!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ol/TileState"),require("ol/geom"),require("ol/style"),require("ol/control"),require("ol/interaction"),require("ol"),require("ol/format"),require("ol/layer"),require("ol/source"),require("ol/loadingstrategy"),require("ol/geom/Polygon"),require("ol/extent"),require("ol/events/condition"),require("ol/proj"),require("ol/Observable")):"function"==typeof define&&define.amd?define(["ol/TileState","ol/geom","ol/style","ol/control","ol/interaction","ol","ol/format","ol/layer","ol/source","ol/loadingstrategy","ol/geom/Polygon","ol/extent","ol/events/condition","ol/proj","ol/Observable"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Wfst=t(e.ol.TileState,e.ol.geom,e.ol.style,e.ol.control,e.ol.interaction,e.ol,e.ol.format,e.ol.layer,e.ol.source,e.ol.loadingstrategy,e.ol.geom.Polygon,e.ol.extent,e.ol.events.condition,e.ol.proj,e.ol.Observable)}(this,(function(e,t,n,r,o,i,a,s,l,c,u,d,h,f,p){"use strict";function v(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=v(e);var y=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r};var g=function(e){if(Array.isArray(e))return y(e)};var _=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var b=function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}};var w=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var k=function(e){return g(e)||_(e)||b(e)||w()};function E(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var L=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),a=new T(r||[]);return i._invoke=function(e,t,n){var r=d;return function(o,i){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw i;return C()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var l=u(e,t,n);if("normal"===l.type){if(r=n.done?p:h,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",v={};function m(){}function y(){}function g(){}var _={};_[i]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(M([])));w&&w!==n&&r.call(w,i)&&(_=w);var k=g.prototype=m.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function n(o,i,a,s){var l=u(e[o],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=u(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function M(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:C}}function C(){return{value:t,done:!0}}return y.prototype=k.constructor=g,g.constructor=y,y.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},E(L.prototype),L.prototype[a]=function(){return this},e.AsyncIterator=L,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new L(c(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(k),l(k,s,"Generator"),k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),F(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;F(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));var S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var F=function(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e},T="Point",M="LineString",C="LinearRing",O="Polygon",j="MultiPoint",N="MultiLineString",I="MultiPolygon",G="GeometryCollection",D="Circle",P="center-center";function q(){}function A(){A.init.call(this)}function z(e){return void 0===e._maxListeners?A.defaultMaxListeners:e._maxListeners}function H(e,t,n){if(t)e.call(n);else for(var r=e.length,o=K(e,r),i=0;i<r;++i)o[i].call(n)}function W(e,t,n,r){if(t)e.call(n,r);else for(var o=e.length,i=K(e,o),a=0;a<o;++a)i[a].call(n,r)}function U(e,t,n,r,o){if(t)e.call(n,r,o);else for(var i=e.length,a=K(e,i),s=0;s<i;++s)a[s].call(n,r,o)}function R(e,t,n,r,o,i){if(t)e.call(n,r,o,i);else for(var a=e.length,s=K(e,a),l=0;l<a;++l)s[l].call(n,r,o,i)}function V(e,t,n,r){if(t)e.apply(n,r);else for(var o=e.length,i=K(e,o),a=0;a<o;++a)i[a].apply(n,r)}function B(e,t,n,r){var o,i,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]):(i=e._events=new q,e._eventsCount=0),a){if("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(o=z(e))&&o>0&&a.length>o){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=i[t]=n,++e._eventsCount;return e}function Z(e,t,n){var r=!1;function o(){e.removeListener(t,o),r||(r=!0,n.apply(e,arguments))}return o.listener=n,o}function $(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function K(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}q.prototype=Object.create(null),A.EventEmitter=A,A.usingDomains=!1,A.prototype.domain=void 0,A.prototype._events=void 0,A.prototype._maxListeners=void 0,A.defaultMaxListeners=10,A.init=function(){this.domain=null,A.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new q,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},A.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},A.prototype.getMaxListeners=function(){return z(this)},A.prototype.emit=function(e){var t,n,r,o,i,a,s,l="error"===e;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(s=this.domain,l){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:H(n,u,this);break;case 2:W(n,u,this,arguments[1]);break;case 3:U(n,u,this,arguments[1],arguments[2]);break;case 4:R(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(r-1),i=1;i<r;i++)o[i-1]=arguments[i];V(n,u,this,o)}return!0},A.prototype.addListener=function(e,t){return B(this,e,t,!1)},A.prototype.on=A.prototype.addListener,A.prototype.prependListener=function(e,t){return B(this,e,t,!0)},A.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Z(this,e,t)),this},A.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Z(this,e,t)),this},A.prototype.removeListener=function(e,t){var n,r,o,i,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new q:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new q,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,o=e.length;r<o;n+=1,r+=1)e[n]=e[r];e.pop()}(n,o);r.removeListener&&this.emit("removeListener",e,a||t)}return this},A.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new q,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new q:delete n[e]),this;if(0===arguments.length){for(var r,o=Object.keys(n),i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new q,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},A.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},A.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):$.call(e,t)},A.prototype.listenerCount=$,A.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const J=document.createElement("div"),Y=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),X=function e(t){for(let n in t)Array.isArray(t[n])?t[n].forEach((t=>{e(t)})):null!==t[n]&&"object"==typeof t[n]&&Object.freeze(t[n]);return Object.freeze(t)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),Q={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function ee(e,t,n){let r=e.data||{};if(void 0===n){if(e.data&&e.data[t])return e.data[t];var o=e.getAttribute(`data-${t}`);return void 0!==o?o:null}return r[t]=n,e.data=r,e}function te(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),J.innerHTML="",J.innerHTML=e,!0===t?J.childNodes:J.childNodes[0])}class ne extends A{static set templates(e){this._baseTemplates=e}static get templates(){return Object.assign({},Q,ne._baseTemplates||{})}static set buttons(e){this._baseButtons=e}static get buttons(){return Object.assign({},X,ne._baseButtons||{})}static set options(e){this._baseOptions=e}static get options(){return Object.assign({},Y,ne._baseOptions||{})}static get version(){return"0.9.0"}static alert(e,t={}){let n=Object.assign({},Y,{title:e,content:!1,construct:!0,headerClose:!1,buttons:ne.buttons.alert},t);return new ne(n)}static confirm(e,t={}){let n=Object.assign({},Y,{title:e,content:!1,construct:!0,headerClose:!1,buttons:ne.buttons.confirm},t);return new ne(n)}constructor(e={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._options=Object.assign({},ne.options,e),this._templates=Object.assign({},ne.templates,e.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),this._scrollbarWidth=function(){let e,t,n,r=document.createElement("div");return Object.assign(r.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(r),n=r.offsetWidth,r.style.overflow="scroll",e=document.createElement("div"),e.style.width="100%",r.appendChild(e),t=n-e.offsetWidth,document.body.removeChild(r),t}(),null===this._options.buttons&&(this._options.buttons=ne.buttons.dialog),this._options.el){let e=this._options.el;if("string"==typeof this._options.el&&(e=document.querySelector(this._options.el),!e))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);ee(e,"modal",this),this.el=e}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let e=this._html,t=this._options,n=this._templates,r=!!t.animate&&t.animateClass;return e.container=te(n.container),e.dialog=te(n.dialog),e.content=te(n.content),e.header=te(n.header),e.headerClose=te(n.headerClose),e.body=te(n.body),e.footer=te(n.footer),r&&e.container.classList.add(r),this._setHeader(),this._setContent(),this._setFooter(),this.el=e.container,e.dialog.appendChild(e.content),e.container.appendChild(e.dialog),this}_mapDom(){let e=this._html,t=this._options;return this.el.classList.contains(t.animateClass)&&(t.animate=!0),e.container=this.el,e.dialog=this.el.querySelector(".modal-dialog"),e.content=this.el.querySelector(".modal-content"),e.header=this.el.querySelector(".modal-header"),e.headerClose=this.el.querySelector(".modal-header .close"),e.body=this.el.querySelector(".modal-body"),e.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let e=this._html,t=this._options;t.header&&e.header&&(t.title.nodeName?e.header.innerHTML=t.title.outerHTML:"string"==typeof t.title&&(e.header.innerHTML=`<h4 class="modal-title">${t.title}</h4>`),null===this.el&&e.headerClose&&t.headerClose&&e.header.appendChild(e.headerClose),t.construct&&e.content.appendChild(e.header))}_setContent(){let e=this._html,t=this._options;t.content&&e.body&&("string"==typeof t.content?e.body.innerHTML=t.content:e.body.innerHTML=t.content.outerHTML,t.construct&&e.content.appendChild(e.body))}_setFooter(){let e=this._html,t=this._options;t.footer&&e.footer&&(t.footer.nodeName?e.footer.ineerHTML=t.footer.outerHTML:"string"==typeof t.footer?e.footer.innerHTML=t.footer:e.footer.children.length||t.buttons.forEach((t=>{let n=document.createElement("button");ee(n,"button",t),n.innerHTML=t.text,n.setAttribute("type","button");for(let e in t.attr)n.setAttribute(e,t.attr[e]);e.footer.appendChild(n)})),t.construct&&e.content.appendChild(e.footer))}_setEvents(){this._options;let e=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),e.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleClickEvent(e){(function(e){let t=[e];for(;e.parentNode;)e=e.parentNode,t.push(e);return t})(e.target).every((t=>"HTML"!==t.tagName&&((!0===this._options.backdrop||!t.classList.contains("modal"))&&(!t.classList.contains("modal-content")&&("modal"===t.getAttribute("data-dismiss")?(this.emit("dismiss",this,e,ee(e.target,"button")),this.hide(),!1):!t.classList.contains("modal")||(this.emit("dismiss",this,e,null),this.hide(),!1))))))}_handleKeydownEvent(e){27===e.which&&this._options.keyboard&&(this.emit("dismiss",this,e,null),this.hide())}_handleResizeEvent(e){this._resize()}show(){let e=this._options,t=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),e.construct&&t.appendTo.appendChild(t.container),t.container.style.display="block",t.container.scrollTop=0,!1!==e.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),e.animate&&t.container.offsetWidth,t.container.classList.add(e.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),e.transition)})),this._backdrop()):(this._setEvents(),e.animate&&t.container.offsetWidth,t.container.classList.add(e.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),e.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var e=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&e?this._scrollbarWidth+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!e?this._scrollbarWidth+"px":""}_backdrop(){let e=this._html,t=this._templates,n=this._options,r=!!n.animate&&n.animateClass;e.backdrop=te(t.backdrop),r&&e.backdrop.classList.add(r),e.appendTo.appendChild(e.backdrop),r&&e.backdrop.offsetWidth,e.backdrop.classList.add(n.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let e=this._html,t=this._options,n=e.container.classList;if(this.emit("hide",this),n.remove(t.animateInClass),t.backdrop){e.backdrop.classList.remove(t.animateInClass)}return this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),t.backdropTransition),setTimeout((()=>{t.backdrop&&e.backdrop.parentNode.removeChild(e.backdrop),e.container.style.display="none",t.construct&&e.container.parentNode.removeChild(e.container),this._visible=!1,this.emit("hidden",this)}),t.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let e=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=e+this._scrollbarWidth+"px"}}}var re=E(Object.freeze({__proto__:null,default:ne})).default,oe="data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='448' height='448' viewBox='0 0 448 448'%3e %3cpath d='M222 296l29-29-38-38-29 29v14h24v24h14zM332 116c-2.25-2.25-6-2-8.25 0.25l-87.5 87.5c-2.25 2.25-2.5 6-0.25 8.25s6 2 8.25-0.25l87.5-87.5c2.25-2.25 2.5-6 0.25-8.25zM352 264.5v47.5c0 39.75-32.25 72-72 72h-208c-39.75 0-72-32.25-72-72v-208c0-39.75 32.25-72 72-72h208c10 0 20 2 29.25 6.25 2.25 1 4 3.25 4.5 5.75 0.5 2.75-0.25 5.25-2.25 7.25l-12.25 12.25c-2.25 2.25-5.25 3-8 2-3.75-1-7.5-1.5-11.25-1.5h-208c-22 0-40 18-40 40v208c0 22 18 40 40 40h208c22 0 40-18 40-40v-31.5c0-2 0.75-4 2.25-5.5l16-16c2.5-2.5 5.75-3 8.75-1.75s5 4 5 7.25zM328 80l72 72-168 168h-72v-72zM439 113l-23 23-72-72 23-23c9.25-9.25 24.75-9.25 34 0l38 38c9.25 9.25 9.25 24.75 0 34z'%3e%3c/path%3e%3c/svg%3e",ie="data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='541' height='512' viewBox='0 0 541 512'%3e %3cpath fill='black' d='M103.306 228.483l129.493-125.249c-17.662-4.272-31.226-18.148-34.98-35.663l-0.055-0.307-129.852 125.248c17.812 4.15 31.53 18.061 35.339 35.662l0.056 0.308z'%3e%3c/path%3e %3cpath fill='black' d='M459.052 393.010c-13.486-8.329-22.346-23.018-22.373-39.779v-0.004c-0.053-0.817-0.082-1.772-0.082-2.733s0.030-1.916 0.089-2.863l-0.007 0.13-149.852 71.94c9.598 8.565 15.611 20.969 15.611 34.779 0 0.014 0 0.029 0 0.043v-0.002c-0.048 5.164-0.94 10.104-2.544 14.711l0.098-0.322z'%3e%3c/path%3e %3cpath fill='black' d='M290.207 57.553c-0.009 15.55-7.606 29.324-19.289 37.819l-0.135 0.093 118.054 46.69c-0.216-1.608-0.346-3.48-0.36-5.379v-0.017c0.033-16.948 9.077-31.778 22.596-39.953l0.209-0.118-122.298-48.056c0.659 2.633 1.098 5.693 1.221 8.834l0.002 0.087z'%3e%3c/path%3e %3cpath fill='black' d='M241.36 410.132l-138.629-160.067c-4.734 17.421-18.861 30.61-36.472 33.911l-0.29 0.045 143.881 166.255c1.668-18.735 14.197-34.162 31.183-40.044l0.327-0.099z'%3e%3c/path%3e %3cpath fill='black' d='M243.446 115.105c-31.785 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.785 0 57.552 25.767 57.552 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM243.446 21.582c-19.866 0-35.97 16.105-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.104-35.97-35.97-35.97v0z'%3e%3c/path%3e %3cpath fill='black' d='M483.224 410.78c-31.786 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.786 0 57.552 25.767 57.552 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM483.224 317.257c-19.866 0-35.97 16.104-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.105-35.97-35.97-35.97v0z'%3e%3c/path%3e %3cpath fill='black' d='M57.553 295.531c-31.785 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.785 0 57.553 25.767 57.553 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM57.553 202.008c-19.866 0-35.97 16.105-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c-0.041-19.835-16.13-35.898-35.97-35.898 0 0 0 0 0 0v0z'%3e%3c/path%3e %3cpath fill='black' d='M256.036 512.072c-31.786 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.786 0 57.553 25.767 57.553 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM256.036 418.55c-19.866 0-35.97 16.104-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.105-35.97-35.97-35.97v0z'%3e%3c/path%3e %3cpath fill='black' d='M435.24 194.239c-31.786 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.786 0 57.553 25.767 57.553 57.553v0c0 31.785-25.767 57.553-57.553 57.553v0zM435.24 100.716c-19.866 0-35.97 16.105-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.105-35.97-35.97-35.97v0z'%3e%3c/path%3e%3c/svg%3e",ae=Object.freeze({__proto__:null,es:{labels:{select:"Seleccionar",addElement:"Modo dibujo",editElement:"Editar elemento",save:"Guardar",delete:"Eliminar",cancel:"Cancelar",apply:"Aplicar cambios",upload:"Subir",editMode:"Modo Edición",confirmDelete:"¿Estás seguro de borrar el elemento?",geomTypeNotSupported:"Geometría no compatible con la capa",editFields:"Editar campos",editGeom:"Editar geometría",selectDrawType:"Tipo de geometría para dibujar",uploadToLayer:"Subir archivo a la capa seleccionada",uploadFeatures:"Subida de elementos a la capa",validFeatures:"Válidas",invalidFeatures:"Invalidas",loading:"Cargando...",toggleVisibility:"Cambiar visibilidad de la capa"},errors:{capabilities:"No se pudieron obtener las Capabilidades del GeoServer",wfst:"El GeoServer no tiene soporte a Transacciones",layer:"No se pudieron obtener datos de la capa",noValidGeometry:"No se encontraron geometrías válidas para agregar a esta capa",geoserver:"No se pudieron obtener datos desde el GeoServer",badFormat:"Formato no soportado",badFile:"Error al leer elementos del archivo",lockFeature:"No se pudieron bloquear elementos en el GeoServer.",transaction:"Error al hacer transacción con el GeoServer. HTTP status:",getFeatures:"Error al obtener elemento desde el GeoServer. HTTP status:"}},en:{labels:{select:"Select",addElement:"Toggle Draw mode",editElement:"Edit feature",save:"Save",delete:"Delete",cancel:"Cancel",apply:"Apply changes",upload:"Upload",editMode:"Edit Mode",confirmDelete:"Are you sure to delete the feature?",geomTypeNotSupported:"Geometry not supported by layer",editFields:"Edit fields",editGeom:"Edit geometry",selectDrawType:"Geometry type to draw",uploadToLayer:"Upload file to selected layer",uploadFeatures:"Uploaded features to layer",validFeatures:"Valid geometries",invalidFeatures:"Invalid",loading:"Loading...",toggleVisibility:"Toggle layer visibility"},errors:{capabilities:"GeoServer Capabilities could not be downloaded.",wfst:"The GeoServer does not support Transactions",layer:"Could not get data from layer",noValidGeometry:"No valid geometries found to add to this layer",geoserver:"Could not get data from the GeoServer",badFormat:"Unsupported format",badFile:"Error reading items from file",lockFeature:"No se pudieron bloquear elementos en el GeoServer. HTTP status:",transaction:"Error when doing Transaction with GeoServer. HTTP status:",getFeatures:"Error getting elements from GeoServer. HTTP status:"}}});function se(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return le(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ce=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},ue="urn:x-ogc:def:crs:EPSG:4326";return function(){function e(t,n){S(this,e),this.options={geoServerUrl:null,headers:{},layers:null,evtType:"singleclick",active:!0,showControl:!0,useLockFeature:!0,minZoom:9,language:"en",uploadFormats:".geojson,.json,.kml",processUpload:null,beforeInsertFeature:null},this.options=Object.assign(Object.assign({},this.options),n),this._i18n=ae[this.options.language],this._hasLockFeature=!1,this._hasTransaction=!1,this._geoServerCapabilities=null,this._geoServerData={},this.map=t,this.view=t.getView(),this.viewport=t.getViewport(),this._mapLayers=[],this._editedFeatures=new Set,this._layerToInsertElements=this.options.layers[0].name,this._insertFeatures=[],this._updateFeatures=[],this._deleteFeatures=[],this._formatWFS=new a.WFS,this._formatGeoJSON=new a.GeoJSON,this._formatKml=new a.KML({extractStyles:!1,showPointNames:!1}),this._xs=new XMLSerializer,this._isVisible=this.view.getZoom()>this.options.minZoom,this._countRequests=0,this._isEditModeOn=!1,this._initAsyncOperations()}return F(e,[{key:"_initAsyncOperations",value:function(){return ce(this,void 0,void 0,L.mark((function e(){return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._createBaseControl(),this._showLoading(),e.next=5,this._connectToGeoServerAndGetCapabilities();case 5:if(!this.options.layers){e.next=9;break}return e.next=8,this._getGeoserverLayersData(this.options.layers,this.options.geoServerUrl);case 8:this._createLayers(this.options.layers);case 9:this._initMapElements(this.options.showControl,this.options.active),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),this._hideLoading(),this._showError(e.t0.message);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})))}},{key:"_createBaseControl",value:function(){this._controlWidgetToolsDiv=document.createElement("div"),this._controlWidgetToolsDiv.className="ol-wfst--tools-control",this._controlWidgetTools=new r.Control({element:this._controlWidgetToolsDiv}),this.map.addControl(this._controlWidgetTools)}},{key:"_connectToGeoServerAndGetCapabilities",value:function(){return ce(this,void 0,void 0,L.mark((function e(){var t,n,r=this;return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){return ce(r,void 0,void 0,L.mark((function e(){var t,n,r,o,i;return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams({service:"wfs",version:"1.3.0",request:"GetCapabilities",exceptions:"application/json"}),n=this.options.geoServerUrl+"?"+t.toString(),e.prev=2,e.next=5,fetch(n,{headers:this.options.headers});case 5:if((r=e.sent).ok){e.next=8;break}throw new Error("");case 8:return e.next=10,r.text();case 10:return o=e.sent,i=(new window.DOMParser).parseFromString(o,"text/xml"),e.abrupt("return",i);case 15:throw e.prev=15,e.t0=e.catch(2),new Error(this._i18n.errors.capabilities);case 18:case"end":return e.stop()}}),e,this,[[2,15]])})))},e.next=3,t();case 3:if(this._geoServerCapabilities=e.sent,n=this._geoServerCapabilities.getElementsByTagName("ows:Operation"),Array.from(n).forEach((function(e){"Transaction"===e.getAttribute("name")?r._hasTransaction=!0:"LockFeature"===e.getAttribute("name")&&(r._hasLockFeature=!0)})),this._hasTransaction){e.next=8;break}throw new Error(this._i18n.errors.wfst);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"_getGeoserverLayersData",value:function(e,t){return ce(this,void 0,void 0,L.mark((function n(){var r,o,i,a,s,l,c,u,d,h,f=this;return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=function(e){return ce(f,void 0,void 0,L.mark((function n(){var r,o,i;return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new URLSearchParams({service:"wfs",version:"1.1.0",request:"DescribeFeatureType",typeName:e,outputFormat:"application/json",exceptions:"application/json"}),o=t+"?"+r.toString(),n.next=4,fetch(o,{headers:this.options.headers});case 4:if((i=n.sent).ok){n.next=7;break}throw new Error("");case 7:return n.next=9,i.json();case 9:return n.abrupt("return",n.sent);case 10:case"end":return n.stop()}}),n,this)})))},o=se(e),n.prev=2,o.s();case 4:if((i=o.n()).done){n.next=20;break}return a=i.value,s=a.name,l=a.label||s,n.prev=8,n.next=11,r(s);case 11:(c=n.sent)&&(u=c.targetNamespace,d=c.featureTypes[0].properties,h=d.find((function(e){return e.type.indexOf("gml:")>=0})),this._geoServerData[s]={namespace:u,properties:d,geomType:h.localType,geomField:h.name}),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(8),this._showError("".concat(this._i18n.errors.layer,' "').concat(l,'"'));case 18:n.next=4;break;case 20:n.next=25;break;case 22:n.prev=22,n.t1=n.catch(2),o.e(n.t1);case 25:return n.prev=25,o.f(),n.finish(25);case 28:case"end":return n.stop()}}),n,this,[[2,22,25,28],[8,15]])})))}},{key:"_createLayers",value:function(e){var t,n=this,r=0,o=0,i=function(){++r===o&&n._hideLoading()},u=function(e){var t=e.name,r=e.cqlFilter,o=e.tilesBuffer,a={SERVICE:"WMS",LAYERS:t,TILED:!0};r&&(a.CQL_FILTER=r),o&&(a.BUFFER=o);var c=new l.TileWMS({url:n.options.geoServerUrl,params:a,serverType:"geoserver",tileLoadFunction:function(e,t){return ce(n,void 0,void 0,L.mark((function n(){var r,o;return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch(t,{headers:this.options.headers});case 3:if((r=n.sent).ok){n.next=6;break}throw new Error("");case 6:return n.next=8,r.blob();case 8:if(void 0===(o=n.sent)){n.next=13;break}e.getImage().src=URL.createObjectURL(o),n.next=14;break;case 13:throw new Error("");case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(0),e.setState(m.default.ERROR);case 19:return n.prev=19,i(),n.finish(19);case 22:case"end":return n.stop()}}),n,this,[[0,16,19,22]])})))}}),u=Object.assign({name:t,type:"_wms_",minZoom:n.options.minZoom,source:c,visible:!0,zIndex:4},e);return new s.Tile(u)},d=function(e){var t=e.name,r=e.cqlFilter,o=e.wfsStrategy||"bbox",u=new l.Vector({format:new a.GeoJSON,strategy:"bbox"===o?c.bbox:c.all,loader:function(e){return ce(n,void 0,void 0,L.mark((function n(){var a,s,l,c,d,h;return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new URLSearchParams({service:"wfs",version:"1.0.0",request:"GetFeature",typename:t,outputFormat:"application/json",exceptions:"application/json",srsName:ue}),r&&a.append("cql_filter",r),"bbox"===o&&(s=f.transformExtent(e,this.view.getProjection().getCode(),ue),a.append("bbox",s.join(",")+",EPSG:4326")),l=this.options.geoServerUrl+"?"+a.toString(),n.prev=4,n.next=7,fetch(l,{headers:this.options.headers});case 7:if((c=n.sent).ok){n.next=10;break}throw new Error("");case 10:return n.next=12,c.json();case 12:d=n.sent,(h=u.getFormat().readFeatures(d,{featureProjection:this.view.getProjection().getCode(),dataProjection:ue})).forEach((function(e){e.set("_layerName_",t,!0)})),u.addFeatures(h),n.next=23;break;case 18:n.prev=18,n.t0=n.catch(4),this._showError(this._i18n.errors.geoserver),console.error(n.t0),u.removeLoadedExtent(e);case 23:return n.prev=23,i(),n.finish(23);case 26:case"end":return n.stop()}}),n,this,[[4,18,23,26]])})))}}),d=Object.assign({name:t,type:"_wfs_",minZoom:n.options.minZoom,source:u,visible:!0,zIndex:2},e);return new s.Vector(d)},h=se(e);try{var p=function(){var e=t.value.name;if(n._geoServerData[e]){var r,i=n.options.layers.find((function(t){return t.name===e}));i.mode||(i.mode="wfs"),(r="wfs"===i.mode?d(i):u(i)).getVisible()&&o++,n.map.addLayer(r),n._mapLayers[e]=r}};for(h.s();!(t=h.n()).done;)p()}catch(e){h.e(e)}finally{h.f()}}},{key:"_initMapElements",value:function(e,t){return ce(this,void 0,void 0,L.mark((function n(){return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this._createEditLayer(),this._addInteractions(),this._addHandlers(),e&&this._addMapControl(),this.activateEditMode(t);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"_addInteractions",value:function(){var e=this;this.options.layers.find((function(e){return"wfs"===e.mode}))&&(e.collectionModify=new i.Collection,e.interactionWfsSelect=new o.Select({hitTolerance:10,style:function(t){return e._styleFunction(t)},toggleCondition:h.never,filter:function(t,n){return!e._isEditModeOn&&n&&"_wfs_"===n.get("type")}}),e.map.addInteraction(e.interactionWfsSelect),e.interactionWfsSelect.on("select",(function(t){var n=t.selected,r=t.deselected,o=t.mapBrowserEvent.coordinate;n.length&&n.forEach((function(t){e._editedFeatures.has(String(t.getId()))||(e.interactionWfsSelect.getLayer(t).getSource().removeFeature(t),e._addFeatureToEdit(t,o))})),r.length&&(e._isEditModeOn||r.forEach((function(t){e.collectionModify.remove(t)})))}))),this.options.layers.find((function(e){return"wms"===e.mode}))&&function(){e.interactionSelectModify=new o.Select({style:function(t){return e._styleFunction(t)},layers:[e._editLayer],toggleCondition:h.never,removeCondition:function(){return!!e._isEditModeOn}}),e.map.addInteraction(e.interactionSelectModify),e.collectionModify=e.interactionSelectModify.getFeatures();var t=function(t){return ce(e,void 0,void 0,L.mark((function e(){var n,r,o=this;return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=L.mark((function e(n){var r,i,a,s,l,c,u,d;return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=o._mapLayers[n]).getVisible()&&"_wms_"===r.get("type")){e.next=3;break}return e.abrupt("return","continue");case 3:return i=t.coordinate,a=o.view.getZoom()>10?10:5,s=r.getSource(),l=s["getFeatureInfoUrl"in s?"getFeatureInfoUrl":"getGetFeatureInfoUrl"](i,o.view.getResolution(),o.view.getProjection().getCode(),{INFO_FORMAT:"application/json",BUFFER:a,FEATURE_COUNT:1,EXCEPTIONS:"application/json"}),e.prev=8,e.next=11,fetch(l,{headers:o.options.headers});case 11:if((c=e.sent).ok){e.next=14;break}throw new Error(o._i18n.errors.getFeatures+" "+c.status);case 14:return e.next=16,c.json();case 16:if(u=e.sent,(d=o._formatGeoJSON.readFeatures(u)).length){e.next=20;break}return e.abrupt("return","continue");case 20:d.forEach((function(e){return o._addFeatureToEdit(e,i,n)})),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(8),o._showError(e.t0.message);case 26:case"end":return e.stop()}}),e,null,[[8,23]])})),e.t0=L.keys(this._mapLayers);case 2:if((e.t1=e.t0()).done){e.next=10;break}return r=e.t1.value,e.delegateYield(n(r),"t2",5);case 5:if("continue"!==e.t2){e.next=8;break}return e.abrupt("continue",2);case 8:e.next=2;break;case 10:case"end":return e.stop()}}),e,this)})))};e._keyClickWms=e.map.on(e.options.evtType,(function(n){return ce(e,void 0,void 0,L.mark((function e(){return L.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.map.hasFeatureAtPixel(n.pixel)){e.next=2;break}return e.abrupt("return");case 2:if(this._isVisible){e.next=4;break}return e.abrupt("return");case 4:if(this._isEditModeOn){e.next=7;break}return e.next=7,t(n);case 7:case"end":return e.stop()}}),e,this)})))}))}(),this.interactionModify=new o.Modify({style:function(){return e._isEditModeOn?new n.Style({image:new n.Circle({radius:6,fill:new n.Fill({color:"#ff0000"}),stroke:new n.Stroke({width:2,color:"rgba(5, 5, 5, 0.9)"})})}):void 0},features:this.collectionModify,condition:function(t){return h.primaryAction(t)&&e._isEditModeOn}}),this.map.addInteraction(this.interactionModify),this.interactionSnap=new o.Snap({source:this._editLayer.getSource()}),this.map.addInteraction(this.interactionSnap)}},{key:"_createEditLayer",value:function(){this._editLayer=new s.Vector({source:new l.Vector,zIndex:5}),this.map.addLayer(this._editLayer)}},{key:"_addHandlers",value:function(){var e=this;this.interactionModify.on("modifystart",(function(t){e._addFeatureToEditedList(t.features.item(0))})),this._onDeselectFeatureEvent(),this._onRemoveFeatureEvent();this.map.on("moveend",(function(){e._currentZoom=e.view.getZoom(),e._currentZoom!==e._lastZoom&&(e._currentZoom>e.options.minZoom?e._isVisible||(e._isVisible=!0):e._isVisible&&(e._isVisible=!1)),e._lastZoom=e._currentZoom})),document.addEventListener("keydown",(function(t){var n=t.key;if(!document.querySelector("input:focus")&&"Delete"===n){var r=e.collectionModify;r&&r.forEach((function(t){e._deleteFeature(t,!0)}))}}))}},{key:"_addMapControl",value:function(){var e=this,t=function(){var t=document.createElement("div");if(t.className="wfst--tools-control--head",e.options.showUpload){var n=function(){var t=document.createElement("div"),n=document.createElement("label");n.className="ol-wfst--tools-control-btn ol-wfst--tools-control-btn-upload",n.htmlFor="ol-wfst--upload",n.innerHTML='<img src="'.concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3e%3cpath d='M240 352h-240v128h480v-128h-240zM448 416h-64v-32h64v32zM112 160l128-128 128 128h-80v160h-96v-160z'%3e%3c/path%3e%3c/svg%3e",'"/> '),n.title=e._i18n.labels.uploadToLayer;var r=document.createElement("input");return r.id="ol-wfst--upload",r.type="file",r.accept=e.options.uploadFormats,r.onchange=function(t){return e._processUploadFile(t)},t.append(r),t.append(n),t}();t.append(n)}var r=function(){var t=document.createElement("div");t.className="ol-wfst--tools-control-draw-cnt";var n=document.createElement("button");n.className="ol-wfst--tools-control-btn ol-wfst--tools-control-btn-draw",n.type="button",n.innerHTML='<img src="'.concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e %3cpath d='M663 225l-58.5 58.5-120-120 58.5-58.5q9-9 22.5-9t22.5 9l75 75q9 9 9 22.5t-9 22.5zM96 552l354-354 120 120-354 354h-120v-120z'%3e%3c/path%3e%3c/svg%3e",'"/>'),n.title=e._i18n.labels.addElement,n.onclick=function(){e._isDrawModeOn?(e._resetStateButtons(),e.activateEditMode()):e.activateDrawMode(e._layerToInsertElements)};var r=document.createElement("select");r.title=e._i18n.labels.selectDrawType,r.className="wfst--tools-control--select-draw",r.onchange=function(){var t=r.value;e._changeStateSelect(e._layerToInsertElements,t),e._isDrawModeOn&&e.activateDrawMode(e._layerToInsertElements)};for(var o=0,i=[T,j,M,N,O,I,D];o<i.length;o++){var a=i[o],s=document.createElement("option");s.value=a,s.text=a,s.selected=e._geoServerData[e._layerToInsertElements].geomType===a||!1,r.appendChild(s)}return t.append(n),t.append(r),e._selectDraw=r,t}();return t.append(r),t}();this._controlWidgetToolsDiv.append(t);var n=function(){var t="";Object.keys(e._mapLayers).map((function(n){return t+=(r=e.options.layers.find((function(e){return e.name===n})),o=r.name,i='<span title="'.concat(e._geoServerData[o].geomType,'">').concat(r.label||o,"</span>"),a=!("visible"in r)||r.visible,'\n                <div class="wfst--layer-control \n                    '.concat(a?"ol-wfst--visible-on":"","\n                    ").concat(o===e._layerToInsertElements?"ol-wfst--selected-on":"",'\n                    " data-layer="').concat(o,'">\n                    <div class="ol-wfst--tools-control-visible">\n                    <span class="ol-wfst--tools-control-visible-btn ol-wfst--visible-btn-on" title="').concat(e._i18n.labels.toggleVisibility,'">\n                      <img src="').concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e%3cpath d='M384 288q39 0 67.5 28.5t28.5 67.5-28.5 67.5-67.5 28.5-67.5-28.5-28.5-67.5 28.5-67.5 67.5-28.5zM384 544.5q66 0 113.25-47.25t47.25-113.25-47.25-113.25-113.25-47.25-113.25 47.25-47.25 113.25 47.25 113.25 113.25 47.25zM384 144q118.5 0 214.5 66t138 174q-42 108-138 174t-214.5 66-214.5-66-138-174q42-108 138-174t214.5-66z'%3e%3c/path%3e%3c/svg%3e",'"/>\n                    </span>\n                    <span class="ol-wfst--tools-control-visible-btn ol-wfst--visible-btn-off" title="').concat(e._i18n.labels.toggleVisibility,'">\n                      <img src="').concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e%3cpath d='M379.5 288h4.5q39 0 67.5 28.5t28.5 67.5v6zM241.5 313.5q-18 36-18 70.5 0 66 47.25 113.25t113.25 47.25q34.5 0 70.5-18l-49.5-49.5q-12 3-21 3-39 0-67.5-28.5t-28.5-67.5q0-9 3-21zM64.5 136.5l40.5-40.5 567 567-40.5 40.5q-7.5-7.5-47.25-46.5t-60.75-60q-64.5 27-139.5 27-118.5 0-214.5-66t-138-174q16.5-39 51.75-86.25t68.25-72.75q-18-18-50.25-51t-36.75-37.5zM384 223.5q-30 0-58.5 12l-69-69q58.5-22.5 127.5-22.5 118.5 0 213.75 66t137.25 174q-36 88.5-109.5 151.5l-93-93q12-28.5 12-58.5 0-66-47.25-113.25t-113.25-47.25z'%3e%3c/path%3e%3c/svg%3e",'"/>\n                    </span>\n                  </div>\n                    <label for="wfst--').concat(o,'">\n                        <input value="').concat(o,'" id="wfst--').concat(o,'" type="radio" class="ol-wfst--tools-control-input" name="wfst--select-layer" ').concat(o===e._layerToInsertElements?'checked="checked"':"",">\n                        ").concat(i,"\n                    </label>\n                </div>"));var r,o,i,a}));var n=document.createElement("div");return n.className="wfst--tools-control--select-layers",n.innerHTML=t,n.querySelectorAll("input").forEach((function(t){var r=t.closest(".wfst--layer-control");t.onchange=function(){var o=n.querySelector(".ol-wfst--selected-on");o&&o.classList.remove("ol-wfst--selected-on"),r.classList.add("ol-wfst--selected-on"),e._layerToInsertElements=t.value,e._changeStateSelect(e._layerToInsertElements)}})),n.querySelectorAll(".ol-wfst--tools-control-visible-btn").forEach((function(t){var n=t.closest(".wfst--layer-control"),r=n.dataset.layer;t.onclick=function(){n.classList.toggle("ol-wfst--visible-on");var t=e._mapLayers[r];n.classList.contains("ol-wfst--visible-on")?t.setVisible(!0):t.setVisible(!1)}})),n}();this._controlWidgetToolsDiv.append(n)}},{key:"_showLoading",value:function(){this._modalLoading||(this._modalLoading=document.createElement("div"),this._modalLoading.className="ol-wfst--tools-control--loading",this._modalLoading.innerHTML=this._i18n.labels.loading,this._controlWidgetToolsDiv.append(this._modalLoading)),this._modalLoading.classList.add("ol-wfst--tools-control--loading-show")}},{key:"_hideLoading",value:function(){this._modalLoading.classList.remove("ol-wfst--tools-control--loading-show")}},{key:"_lockFeature",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ce(this,void 0,void 0,L.mark((function r(){var o,i,a,s,l,c;return L.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=new URLSearchParams({service:"wfs",version:"1.1.0",request:"LockFeature",expiry:String(5),LockId:"GeoServer",typeName:t,releaseAction:"SOME",exceptions:"application/json",featureid:"".concat(e)}),i=this.options.geoServerUrl+"?"+o.toString(),r.prev=2,r.next=5,fetch(i,{headers:this.options.headers});case 5:if((a=r.sent).ok){r.next=8;break}throw new Error(this._i18n.errors.lockFeature);case 8:return r.next=10,a.text();case 10:s=r.sent;try{"exceptions"in(l=JSON.parse(s))&&("CannotLockAllFeatures"===(c=l.exceptions)[0].code?n?this._showError(this._i18n.errors.lockFeature):this._lockFeature(e,t,1):this._showError(c[0].text))}catch(e){}return r.abrupt("return",s);case 15:r.prev=15,r.t0=r.catch(2),this._showError(r.t0.message);case 18:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"_showError",value:function(e){re.alert("Error: "+e,{animateInClass:"in"}).show()}},{key:"_transactWFS",value:function(e,t,n){return ce(this,void 0,void 0,L.mark((function r(){var o,a,s,l,c,d,h,f,p,v,m,y,g,_=this;return L.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=function(e,t){var n=u.fromCircle(t);e.setGeometry(n)},a=function(e,t){var n=t.getGeometries()[0];n.getType()===D&&(n=u.fromCircle(n)),e.setGeometry(n)},t=Array.isArray(t)?t:[t],s=function(e){_._removeFeatureFromEditList(e);var t=e.getProperties();delete t.boundedBy,delete t._layerName_;var n=new i.Feature(t);return n.setId(e.getId()),n},l=function(e){var t=e.getSource();t.refresh();var n=t.getParams();n.t=(new Date).getMilliseconds(),t.updateParams(n)},c=function(e){e.getSource().refresh()},d=[],h=se(t);try{for(h.s();!(f=h.n()).done;)p=f.value,v=s(p),m=v.getGeometry(),(y=m.getType())===G?a(v,m):y===D&&o(v,m),"insert"===e&&this.options.beforeInsertFeature&&(v=this.options.beforeInsertFeature(v)),v&&d.push(v)}catch(e){h.e(e)}finally{h.f()}if(d.length){r.next=11;break}return r.abrupt("return",this._showError(this._i18n.errors.noValidGeometry));case 11:r.t0=e,r.next="insert"===r.t0?14:"update"===r.t0?16:"delete"===r.t0?18:20;break;case 14:return this._insertFeatures=[].concat(k(this._insertFeatures),d),r.abrupt("break",21);case 16:return this._updateFeatures=[].concat(k(this._updateFeatures),d),r.abrupt("break",21);case 18:return this._deleteFeatures=[].concat(k(this._deleteFeatures),d),r.abrupt("break",21);case 20:return r.abrupt("break",21);case 21:this._countRequests++,g=this._countRequests,setTimeout((function(){return ce(_,void 0,void 0,L.mark((function r(){var o,i,a,s,u,d,h,f,p,v,m,y,_,b,w,k,E;return L.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(g===this._countRequests){r.next=2;break}return r.abrupt("return");case 2:return o="EPSG:4326"===(o=this.view.getProjection().getCode())?ue:o,i={featureNS:this._geoServerData[n].namespace,featureType:n,srsName:o,featurePrefix:null,nativeElements:null},a=this._formatWFS.writeTransaction(this._insertFeatures,this._updateFeatures,this._deleteFeatures,i),s=this._xs.serializeToString(a),u=this._geoServerData[n].geomType,d=this._geoServerData[n].geomField,u===G&&("insert"===e?s=(s=s.replace(/<geometry>/g,'<geometry><MultiGeometry xmlns="http://www.opengis.net/gml" srsName="'.concat(o,'"><geometryMember>'))).replace(/<\/geometry>/g,"</geometryMember></MultiGeometry></geometry>"):"update"===e&&(h='<MultiGeometry xmlns="http://www.opengis.net/gml" srsName="'.concat(o,'"><geometryMember>'),"</geometryMember></MultiGeometry>",s=s.replace(/(.*)(<Name>geometry<\/Name><Value>)(.*?)(<\/Value>)(.*)/g,"$1$2".concat(h,"$3").concat("</geometryMember></MultiGeometry>","$4$5")))),s="insert"===e?s.replace(/<(\/?)\bgeometry\b>/g,"<$1".concat(d,">")):s.replace(/<Name>geometry<\/Name>/g,"<Name>".concat(d,"</Name>")),this._hasLockFeature&&this._useLockFeature&&"insert"!==e&&(s=s.replace("</Transaction>","<LockId>GeoServer</LockId></Transaction>")),r.prev=12,f=Object.assign({"Content-Type":"text/xml"},this.options.headers),r.next=16,fetch(this.options.geoServerUrl,{method:"POST",body:s,headers:f});case 16:if((p=r.sent).ok){r.next=19;break}throw new Error(this._i18n.errors.transaction+" "+p.status);case 19:if(v=this._formatWFS.readTransactionResponse(p),Object.keys(v).length){r.next=26;break}return r.next=23,p.text();case 23:m=r.sent,(y=String(m).match(/<ows:ExceptionText>([\s\S]*?)<\/ows:ExceptionText>/))&&this._showError(y[1]);case 26:if("delete"!==e){_=se(t);try{for(_.s();!(b=_.n()).done;)w=b.value,this._editLayer.getSource().removeFeature(w)}catch(e){_.e(e)}finally{_.f()}}k=this.options.layers.find((function(e){return e.name===n})),"wfs"===(E=k.mode)?c(this._mapLayers[n]):"wms"===E&&l(this._mapLayers[n]),this._hideLoading(),r.next=35;break;case 32:r.prev=32,r.t0=r.catch(12),console.error(r.t0);case 35:this._insertFeatures=[],this._updateFeatures=[],this._deleteFeatures=[],this._countRequests=0;case 39:case"end":return r.stop()}}),r,this,[[12,32]])})))}),0);case 24:case"end":return r.stop()}}),r,this)})))}},{key:"_addFeatureToEditedList",value:function(e){this._editedFeatures.add(String(e.getId()))}},{key:"_removeFeatureFromEditList",value:function(e){this._editedFeatures.delete(String(e.getId()))}},{key:"_isFeatureEdited",value:function(e){return this._editedFeatures.has(String(e.getId()))}},{key:"_deselectEditFeature",value:function(e){this._removeOverlayHelper(e)}},{key:"_restoreFeatureToLayer",value:function(e,t){t=t||e.get("_layerName_"),this._mapLayers[t].getSource().addFeature(e)}},{key:"_removeFeatureFromTmpLayer",value:function(e){this._editLayer.getSource().removeFeature(e)}},{key:"_onDeselectFeatureEvent",value:function(){var e=this;this._keySelect=this.collectionModify.on("remove",(function(t){var n=t.element;e._deselectEditFeature(n),function(t){var n=t.get("_layerName_"),r=e.options.layers.find((function(e){return e.name===n})).mode;"wfs"===r&&e.interactionWfsSelect.getFeatures().remove(t),e._isFeatureEdited(t)?e._transactWFS("update",t,n):("wfs"===r&&e._restoreFeatureToLayer(t,n),e._removeFeatureFromTmpLayer(t))}(n),e._editModeOff()}))}},{key:"_onRemoveFeatureEvent",value:function(){var e=this;this._keyRemove=this._editLayer.getSource().on("removefeature",(function(t){var n=t.feature;if(n.get("_delete_")){e._keySelect&&p.unByKey(e._keySelect);var r=n.get("_layerName_");e._transactWFS("delete",n,r),e._deselectEditFeature(n),e._editModeOff(),e._keySelect&&setTimeout((function(){e._onDeselectFeatureEvent()}),150)}}))}},{key:"_styleFunction",value:function(e){var r=function(e){var n=e.getGeometry(),r=n.getType();r===G&&(r=(n=n.getGeometries()[0]).getType());var o=n.getCoordinates(),i=null;if((i=r===O||r===N?o.flat(1):r===I?o.flat(2):o)&&i.length)return new t.MultiPoint(i)},o=e.getGeometry(),i=o.getType();switch(i===G&&(i=(o=o.getGeometries()[0]).getType()),i){case"Point":case"MultiPoint":return this._isEditModeOn?[new n.Style({image:new n.Circle({radius:6,fill:new n.Fill({color:"#000000"})})}),new n.Style({image:new n.Circle({radius:4,fill:new n.Fill({color:"#ff0000"})})})]:[new n.Style({image:new n.Circle({radius:5,fill:new n.Fill({color:"#ff0000"})})}),new n.Style({image:new n.Circle({radius:2,fill:new n.Fill({color:"#000000"})})})];default:return this._isEditModeOn||this._isDrawModeOn?[new n.Style({stroke:new n.Stroke({color:"rgba( 255, 0, 0, 1)",width:4}),fill:new n.Fill({color:"rgba(255, 0, 0, 0.7)"})}),new n.Style({image:new n.Circle({radius:4,fill:new n.Fill({color:"#ff0000"}),stroke:new n.Stroke({width:2,color:"rgba(5, 5, 5, 0.9)"})}),geometry:function(e){return r(e)}}),new n.Style({stroke:new n.Stroke({color:"rgba(255, 255, 255, 0.7)",width:2})})]:[new n.Style({image:new n.Circle({radius:2,fill:new n.Fill({color:"#000000"})}),geometry:function(e){return r(e)}}),new n.Style({stroke:new n.Stroke({color:"#ff0000",width:4}),fill:new n.Fill({color:"rgba(255, 0, 0, 0.7)"})})]}}},{key:"_editModeOn",value:function(e){var t=this;this._editFeatureOriginal=e.clone(),this._isEditModeOn=!0,this._editLayer.getSource().changed(),this._removeOverlayHelper(e);var n=document.createElement("div");n.className="ol-wfst--changes-control";var o=document.createElement("div");o.className="ol-wfst--changes-control-el";var i=document.createElement("div");i.className="ol-wfst--changes-control-id",i.innerHTML="<b>".concat(this._i18n.labels.editMode,"</b> - <i>").concat(String(e.getId()),"</i>");var a=document.createElement("button");a.type="button",a.textContent=this._i18n.labels.apply,a.className="btn btn-primary",a.onclick=function(){t._showLoading(),t.collectionModify.remove(e)};var s=document.createElement("button");s.type="button",s.textContent=this._i18n.labels.cancel,s.className="btn btn-secondary",s.onclick=function(){e.setGeometry(t._editFeatureOriginal.getGeometry()),t._removeFeatureFromEditList(e),t.collectionModify.remove(e)},o.append(i),o.append(s),o.append(a),n.append(o),this._controlApplyDiscardChanges=new r.Control({element:n}),this.map.addControl(this._controlApplyDiscardChanges)}},{key:"_editModeOff",value:function(){this._isEditModeOn=!1,this.map.removeControl(this._controlApplyDiscardChanges)}},{key:"_deleteFeature",value:function(e,t){var n=this,r=function(){(Array.isArray(e)?e:[e]).forEach((function(e){e.set("_delete_",!0,!0),n._editLayer.getSource().removeFeature(e)})),n.collectionModify.clear();var t=e.get("_layerName_");"wfs"===n.options.layers.find((function(e){return e.name===t})).mode&&n.interactionWfsSelect.getFeatures().remove(e)};t?re.confirm(this._i18n.labels.confirmDelete,{animateInClass:"in"}).show().once("dismiss",(function(e,t,n){n&&n.value&&r()})):r()}},{key:"_addFeatureToEdit",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=function(){var r='<img src="'.concat(oe,'"/>'),o=document.createElement("div");o.className="ol-wfst--edit-button-cnt",o.innerHTML='<button class="ol-wfst--edit-button" type="button" title="'.concat(t._i18n.labels.editFields,'">').concat(r,"</button>"),o.onclick=function(){t._initEditFieldsModal(e)};var a=document.createElement("div");a.append(o);var s='<img src="'.concat(ie,'"/>'),l=document.createElement("div");l.className="ol-wfst--edit-button-cnt",l.innerHTML='<button class="ol-wfst--edit-button" type="button" title="'.concat(t._i18n.labels.editGeom,'">').concat(s,"</button>"),l.onclick=function(){t._editModeOn(e)},a.append(l);var c=n||d.getCenter(e.getGeometry().getExtent()),u=new i.Overlay({id:e.getId(),position:c,positioning:P,element:a,offset:[0,-40],stopEvent:!0});t.map.addOverlay(u)};r&&e.set("_layerName_",r);var a=e?e.getProperties():"";a&&e.getGeometry()&&(this._editLayer.getSource().addFeature(e),this.collectionModify.push(e),o(),this._useLockFeature&&this._hasLockFeature&&this._lockFeature(e.getId(),e.get("_layerName_")))}},{key:"_resetStateButtons",value:function(){var e=document.querySelector(".ol-wfst--tools-control-btn.wfst--active");e&&e.classList.remove("wfst--active")}},{key:"_initUploadFileModal",value:function(e,t){var n=this,r='\n            <button type="button" class="btn btn-secondary" data-dismiss="modal">\n                '.concat(this._i18n.labels.cancel,'\n            </button>\n            <button type="button" class="btn btn-primary" data-action="save" data-dismiss="modal">\n                ').concat(this._i18n.labels.upload,"\n            </button>\n        ");new re({header:!0,headerClose:!1,title:this._i18n.labels.uploadFeatures+" "+this._layerToInsertElements,content:e,backdrop:"static",footer:r,animateInClass:"in"}).show().on("dismiss",(function(e,r){"save"===r.target.dataset.action?n._transactWFS("insert",t,n._layerToInsertElements):n._editLayer.getSource().clear()}))}},{key:"_processUploadFile",value:function(e){return ce(this,void 0,void 0,L.mark((function n(){var r,o,i,a,s,l,c,u,d,h,f,p,v,m,y=this;return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=function(e){return new Promise((function(t,n){var r=new FileReader;r.addEventListener("load",(function(e){return ce(y,void 0,void 0,L.mark((function n(){var r;return L.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=e.target.result,t(r);case 2:case"end":return n.stop()}}),n)})))})),r.addEventListener("error",(function(e){console.error("Error"+e),n()})),r.readAsText(e)}))},o=function(e){var n,r=y._geoServerData[y._layerToInsertElements].geomType;switch(e.getGeometry().getType()){case"Point":if("MultiPoint"===r){var o=e.getGeometry().getCoordinates();n=new t.MultiPoint([o])}break;case"LineString":if("MultiLineString"===r){var i=e.getGeometry().getCoordinates();n=new t.MultiLineString([i])}break;case"Polygon":if("MultiPolygon"===r){var a=e.getGeometry().getCoordinates();n=new t.MultiPolygon([a])}break;default:n=null}return n?(e.setGeometry(n),e):null},i=function(e){var t=y._geoServerData[y._layerToInsertElements].geomType,n=e.getGeometry().getType();return t===G||n===t},a=e.target.files[0]){n.next=6;break}return n.abrupt("return");case 6:if(l=a.name.split(".").pop().toLowerCase(),n.prev=7,this.options.processUpload&&(s=this.options.processUpload(a)),s){n.next=14;break}return n.next=12,r(a);case 12:c=n.sent,"geojson"===l||"json"===l?s=this._formatGeoJSON.readFeatures(c,{featureProjection:this.view.getProjection().getCode()}):"kml"===l?s=this._formatKml.readFeatures(c,{featureProjection:this.view.getProjection().getCode()}):this._showError(this._i18n.errors.badFormat);case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(7),this._showError(this._i18n.errors.badFile);case 19:u=0,d=0,h=[],f=se(s),n.prev=23,f.s();case 25:if((p=f.n()).done){n.next=37;break}if(v=p.value,i(v)||(v=o(v)),!v){n.next=33;break}h.push(v),d++,n.next=35;break;case 33:return u++,n.abrupt("continue",35);case 35:n.next=25;break;case 37:n.next=42;break;case 39:n.prev=39,n.t1=n.catch(23),f.e(n.t1);case 42:return n.prev=42,f.f(),n.finish(42);case 45:d?(this._resetStateButtons(),this.activateEditMode(),m="\n                ".concat(this._i18n.labels.validFeatures,": ").concat(d,"<br>\n                ").concat(u?"".concat(this._i18n.labels.invalidFeatures,": ").concat(u):"","\n            "),this._initUploadFileModal(m,h),this._editLayer.getSource().addFeatures(h),this.view.fit(this._editLayer.getSource().getExtent(),{size:this.map.getSize(),maxZoom:21,padding:[100,100,100,100]})):this._showError(this._i18n.errors.noValidGeometry),e.target.value=null;case 47:case"end":return n.stop()}}),n,this,[[7,16],[23,39,42,45]])})))}},{key:"_changeStateSelect",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=function(e,t){Array.from(n._selectDraw.options).forEach((function(r){r.selected=r.value===e,r.disabled="all"!==t&&!t.includes(r.value),r.title=r.disabled?n._i18n.labels.geomTypeNotSupported:""}))};if(this._selectDraw){var i=this._geoServerData[e].geomType;r?t=this._selectDraw.value:i===G?o(t=M,"all"):i===C?(o(t=M,[D,C,O]),this._selectDraw.value=t):o(t=i,[i])}return t}},{key:"activateDrawMode",value:function(e){var t=this;if(this.interactionDraw||e){if(e){if(!this._mapLayers[e].getVisible())return;var n=document.querySelector(".ol-wfst--tools-control-btn-draw");n&&n.classList.add("wfst--active"),this.viewport.classList.add("draw-mode"),function(e){t.activateEditMode(!1),t.interactionDraw&&t.map.removeInteraction(t.interactionDraw);var n=t._selectDraw.value;t.interactionDraw=new o.Draw({source:t._editLayer.getSource(),type:n,style:function(e){return t._styleFunction(e)}}),t.map.addInteraction(t.interactionDraw),t.interactionDraw.on("drawend",(function(n){var r=n.feature;t._transactWFS("insert",r,e)}))}(String(e))}else this.map.removeInteraction(this.interactionDraw),this.viewport.classList.remove("draw-mode");this._isDrawModeOn=!!e}}},{key:"activateEditMode",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e){var t=document.querySelector(".ol-wfst--tools-control-btn-edit");t&&t.classList.add("wfst--active"),this.activateDrawMode(!1)}else this.collectionModify.clear();this.interactionSelectModify&&this.interactionSelectModify.setActive(e),this.interactionModify.setActive(e),this.interactionWfsSelect&&this.interactionWfsSelect.setActive(e)}},{key:"insertFeaturesTo",value:function(e,t){this._transactWFS("insert",t,e)}},{key:"_initEditFieldsModal",value:function(e){var t=this;this._editFeature=e;var n=e.getProperties(),r=e.get("_layerName_"),o=this._geoServerData[r].properties,i='<form autocomplete="false">';Object.keys(n).forEach((function(e){var t=o.find((function(t){return t.name===e}));if(t){var r;switch(t.type){case"xsd:string":r="text";break;case"xsd:number":case"xsd:int":r="number";break;case"xsd:date-time":r="datetime";break;default:r="text"}r&&(i+='\n                <div class="ol-wfst--input-field-container">\n                    <label class="ol-wfst--input-field-label" for="'.concat(e,'">').concat(e,'</label>\n                    <input placeholder="NULL" class="ol-wfst--input-field-input" type="').concat(r,'" name="').concat(e,'" value="').concat(n[e]||"",'">\n                </div>'))}})),i+="</form>";var a='\n            <button type="button" class="btn btn-link btn-third" data-action="delete" data-dismiss="modal">\n                '.concat(this._i18n.labels.delete,'\n            </button>\n            <button type="button" class="btn btn-secondary" data-dismiss="modal">\n                ').concat(this._i18n.labels.cancel,'\n            </button>\n            <button type="button" class="btn btn-primary" data-action="save" data-dismiss="modal">\n                ').concat(this._i18n.labels.save,"\n            </button>\n        ");new re({header:!0,headerClose:!0,title:"".concat(this._i18n.labels.editElement," ").concat(this._editFeature.getId()," "),content:i,footer:a,animateInClass:"in"}).show().on("dismiss",(function(e,n){"save"===n.target.dataset.action?(e.el.querySelectorAll("input").forEach((function(e){var n=e.value,r=e.name;t._editFeature.set(r,n,!0)})),t._editFeature.changed(),t._addFeatureToEditedList(t._editFeature),t.collectionModify.remove(t._editFeature)):"delete"===n.target.dataset.action&&t._deleteFeature(t._editFeature,!0)}))}},{key:"_removeOverlayHelper",value:function(e){var t=e.getId();if(t){var n=this.map.getOverlayById(t);n&&this.map.removeOverlay(n)}}}]),e}()}));
