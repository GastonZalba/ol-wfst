!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("core-js/modules/es7.symbol.async-iterator"),require("core-js/modules/es6.symbol"),require("core-js/modules/es7.array.includes"),require("core-js/modules/es6.string.includes"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.match"),require("core-js/modules/es6.regexp.replace"),require("core-js/modules/es6.object.keys"),require("core-js/modules/es6.array.find"),require("core-js/modules/es6.array.from"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.function.name"),require("core-js/modules/web.dom.iterable"),require("core-js/modules/es6.array.iterator"),require("core-js/modules/es6.string.iterator"),require("core-js/modules/es6.set"),require("core-js/modules/es6.object.assign"),require("core-js/modules/es6.promise"),require("core-js/modules/es6.object.to-string"),require("ol/TileState"),require("ol/geom"),require("ol/style"),require("ol/control"),require("ol/interaction"),require("ol"),require("ol/format"),require("ol/layer"),require("ol/source"),require("ol/loadingstrategy"),require("ol/geom/Polygon"),require("ol/extent"),require("ol/events/condition"),require("ol/proj"),require("ol/Observable")):"function"==typeof define&&define.amd?define(["core-js/modules/es7.symbol.async-iterator","core-js/modules/es6.symbol","core-js/modules/es7.array.includes","core-js/modules/es6.string.includes","core-js/modules/es6.regexp.split","core-js/modules/es6.regexp.match","core-js/modules/es6.regexp.replace","core-js/modules/es6.object.keys","core-js/modules/es6.array.find","core-js/modules/es6.array.from","core-js/modules/es6.regexp.to-string","core-js/modules/es6.function.name","core-js/modules/web.dom.iterable","core-js/modules/es6.array.iterator","core-js/modules/es6.string.iterator","core-js/modules/es6.set","core-js/modules/es6.object.assign","core-js/modules/es6.promise","core-js/modules/es6.object.to-string","ol/TileState","ol/geom","ol/style","ol/control","ol/interaction","ol","ol/format","ol/layer","ol/source","ol/loadingstrategy","ol/geom/Polygon","ol/extent","ol/events/condition","ol/proj","ol/Observable"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Wfst=t(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,e.ol.TileState,e.ol.geom,e.ol.style,e.ol.control,e.ol.interaction,e.ol,e.ol.format,e.ol.layer,e.ol.source,e.ol.loadingstrategy,e.ol.geom.Polygon,e.ol.extent,e.ol.events.condition,e.ol.proj,e.ol.Observable)}(this,(function(e,t,r,n,o,i,a,s,l,c,u,d,h,f,m,p,v,g,y,_,b,w,k,E,x,S,L,F,T,M,C,j,O,q){"use strict";function N(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var I=N(_),G=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof v?t:v,i=Object.create(o.prototype),a=new T(n||[]);return i._invoke=function(e,t,r){var n=d;return function(o,i){if(n===f)throw new Error("Generator is already running");if(n===m){if("throw"===o)throw i;return C()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var l=u(e,t,r);if("normal"===l.type){if(n=r.done?m:h,l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=m,r.method="throw",r.arg=l.arg)}}}(e,r,a),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",h="suspendedYield",f="executing",m="completed",p={};function v(){}function g(){}function y(){}var _={};_[i]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(M([])));w&&w!==r&&n.call(w,i)&&(_=w);var k=y.prototype=v.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(o,i,a,s){var l=u(e[o],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function S(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=u(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function M(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:C}}function C(){return{value:t,done:!0}}return g.prototype=k.constructor=y,y.constructor=g,g.displayName=l(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},E(x.prototype),x.prototype[a]=function(){return this},e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(k),l(k,s,"Generator"),k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),F(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:M(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),p}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=G}catch(e){Function("r","regeneratorRuntime = r")(G)}var R="Point",D="LineString",P="LinearRing",A="Polygon",z="MultiPoint",H="MultiLineString",W="MultiPolygon",U="GeometryCollection",V="Circle",B="center-center";function Z(){}function $(){$.init.call(this)}function K(e){return void 0===e._maxListeners?$.defaultMaxListeners:e._maxListeners}function J(e,t,r){if(t)e.call(r);else for(var n=e.length,o=oe(e,n),i=0;i<n;++i)o[i].call(r)}function Y(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,i=oe(e,o),a=0;a<o;++a)i[a].call(r,n)}function X(e,t,r,n,o){if(t)e.call(r,n,o);else for(var i=e.length,a=oe(e,i),s=0;s<i;++s)a[s].call(r,n,o)}function Q(e,t,r,n,o,i){if(t)e.call(r,n,o,i);else for(var a=e.length,s=oe(e,a),l=0;l<a;++l)s[l].call(r,n,o,i)}function ee(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,i=oe(e,o),a=0;a<o;++a)i[a].apply(r,n)}function te(e,t,r,n){var o,i,a,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]):(i=e._events=new Z,e._eventsCount=0),a){if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(o=K(e))&&o>0&&a.length>o){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=i[t]=r,++e._eventsCount;return e}function re(e,t,r){var n=!1;function o(){e.removeListener(t,o),n||(n=!0,r.apply(e,arguments))}return o.listener=r,o}function ne(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function oe(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Z.prototype=Object.create(null),$.EventEmitter=$,$.usingDomains=!1,$.prototype.domain=void 0,$.prototype._events=void 0,$.prototype._maxListeners=void 0,$.defaultMaxListeners=10,$.init=function(){this.domain=null,$.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Z,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},$.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},$.prototype.getMaxListeners=function(){return K(this)},$.prototype.emit=function(e){var t,r,n,o,i,a,s,l="error"===e;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(s=this.domain,l){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(r=a[e]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:J(r,u,this);break;case 2:Y(r,u,this,arguments[1]);break;case 3:X(r,u,this,arguments[1],arguments[2]);break;case 4:Q(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];ee(r,u,this,o)}return!0},$.prototype.addListener=function(e,t){return te(this,e,t,!1)},$.prototype.on=$.prototype.addListener,$.prototype.prependListener=function(e,t){return te(this,e,t,!0)},$.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,re(this,e,t)),this},$.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,re(this,e,t)),this},$.prototype.removeListener=function(e,t){var r,n,o,i,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Z:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length;i-- >0;)if(r[i]===t||r[i].listener&&r[i].listener===t){a=r[i].listener,o=i;break}if(o<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Z,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o);n.removeListener&&this.emit("removeListener",e,a||t)}return this},$.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Z,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Z:delete r[e]),this;if(0===arguments.length){for(var n,o=Object.keys(r),i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new Z,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},$.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},$.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):ne.call(e,t)},$.prototype.listenerCount=ne,$.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const ie=document.createElement("div"),ae=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),se=function e(t){for(let r in t)Array.isArray(t[r])?t[r].forEach((t=>{e(t)})):null!==t[r]&&"object"==typeof t[r]&&Object.freeze(t[r]);return Object.freeze(t)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),le={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function ce(e,t,r){let n=e.data||{};if(void 0===r){if(e.data&&e.data[t])return e.data[t];var o=e.getAttribute(`data-${t}`);return void 0!==o?o:null}return n[t]=r,e.data=n,e}function ue(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),ie.innerHTML="",ie.innerHTML=e,!0===t?ie.childNodes:ie.childNodes[0])}class de extends ${static set templates(e){this._baseTemplates=e}static get templates(){return Object.assign({},le,de._baseTemplates||{})}static set buttons(e){this._baseButtons=e}static get buttons(){return Object.assign({},se,de._baseButtons||{})}static set options(e){this._baseOptions=e}static get options(){return Object.assign({},ae,de._baseOptions||{})}static get version(){return"0.9.0"}static alert(e,t={}){let r=Object.assign({},ae,{title:e,content:!1,construct:!0,headerClose:!1,buttons:de.buttons.alert},t);return new de(r)}static confirm(e,t={}){let r=Object.assign({},ae,{title:e,content:!1,construct:!0,headerClose:!1,buttons:de.buttons.confirm},t);return new de(r)}constructor(e={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._options=Object.assign({},de.options,e),this._templates=Object.assign({},de.templates,e.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),this._scrollbarWidth=function(){let e,t,r,n=document.createElement("div");return Object.assign(n.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(n),r=n.offsetWidth,n.style.overflow="scroll",e=document.createElement("div"),e.style.width="100%",n.appendChild(e),t=r-e.offsetWidth,document.body.removeChild(n),t}(),null===this._options.buttons&&(this._options.buttons=de.buttons.dialog),this._options.el){let e=this._options.el;if("string"==typeof this._options.el&&(e=document.querySelector(this._options.el),!e))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);ce(e,"modal",this),this.el=e}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let e=this._html,t=this._options,r=this._templates,n=!!t.animate&&t.animateClass;return e.container=ue(r.container),e.dialog=ue(r.dialog),e.content=ue(r.content),e.header=ue(r.header),e.headerClose=ue(r.headerClose),e.body=ue(r.body),e.footer=ue(r.footer),n&&e.container.classList.add(n),this._setHeader(),this._setContent(),this._setFooter(),this.el=e.container,e.dialog.appendChild(e.content),e.container.appendChild(e.dialog),this}_mapDom(){let e=this._html,t=this._options;return this.el.classList.contains(t.animateClass)&&(t.animate=!0),e.container=this.el,e.dialog=this.el.querySelector(".modal-dialog"),e.content=this.el.querySelector(".modal-content"),e.header=this.el.querySelector(".modal-header"),e.headerClose=this.el.querySelector(".modal-header .close"),e.body=this.el.querySelector(".modal-body"),e.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let e=this._html,t=this._options;t.header&&e.header&&(t.title.nodeName?e.header.innerHTML=t.title.outerHTML:"string"==typeof t.title&&(e.header.innerHTML=`<h4 class="modal-title">${t.title}</h4>`),null===this.el&&e.headerClose&&t.headerClose&&e.header.appendChild(e.headerClose),t.construct&&e.content.appendChild(e.header))}_setContent(){let e=this._html,t=this._options;t.content&&e.body&&("string"==typeof t.content?e.body.innerHTML=t.content:e.body.innerHTML=t.content.outerHTML,t.construct&&e.content.appendChild(e.body))}_setFooter(){let e=this._html,t=this._options;t.footer&&e.footer&&(t.footer.nodeName?e.footer.ineerHTML=t.footer.outerHTML:"string"==typeof t.footer?e.footer.innerHTML=t.footer:e.footer.children.length||t.buttons.forEach((t=>{let r=document.createElement("button");ce(r,"button",t),r.innerHTML=t.text,r.setAttribute("type","button");for(let e in t.attr)r.setAttribute(e,t.attr[e]);e.footer.appendChild(r)})),t.construct&&e.content.appendChild(e.footer))}_setEvents(){this._options;let e=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),e.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleClickEvent(e){(function(e){let t=[e];for(;e.parentNode;)e=e.parentNode,t.push(e);return t})(e.target).every((t=>"HTML"!==t.tagName&&((!0===this._options.backdrop||!t.classList.contains("modal"))&&(!t.classList.contains("modal-content")&&("modal"===t.getAttribute("data-dismiss")?(this.emit("dismiss",this,e,ce(e.target,"button")),this.hide(),!1):!t.classList.contains("modal")||(this.emit("dismiss",this,e,null),this.hide(),!1))))))}_handleKeydownEvent(e){27===e.which&&this._options.keyboard&&(this.emit("dismiss",this,e,null),this.hide())}_handleResizeEvent(e){this._resize()}show(){let e=this._options,t=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),e.construct&&t.appendTo.appendChild(t.container),t.container.style.display="block",t.container.scrollTop=0,!1!==e.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),e.animate&&t.container.offsetWidth,t.container.classList.add(e.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),e.transition)})),this._backdrop()):(this._setEvents(),e.animate&&t.container.offsetWidth,t.container.classList.add(e.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),e.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var e=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&e?this._scrollbarWidth+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!e?this._scrollbarWidth+"px":""}_backdrop(){let e=this._html,t=this._templates,r=this._options,n=!!r.animate&&r.animateClass;e.backdrop=ue(t.backdrop),n&&e.backdrop.classList.add(n),e.appendTo.appendChild(e.backdrop),n&&e.backdrop.offsetWidth,e.backdrop.classList.add(r.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let e=this._html,t=this._options,r=e.container.classList;if(this.emit("hide",this),r.remove(t.animateInClass),t.backdrop){e.backdrop.classList.remove(t.animateInClass)}return this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),t.backdropTransition),setTimeout((()=>{t.backdrop&&e.backdrop.parentNode.removeChild(e.backdrop),e.container.style.display="none",t.construct&&e.container.parentNode.removeChild(e.container),this._visible=!1,this.emit("hidden",this)}),t.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let e=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=e+this._scrollbarWidth+"px"}}}function he(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var fe=he(Object.freeze({__proto__:null,default:de})).default,me="data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='448' height='448' viewBox='0 0 448 448'%3e %3cpath d='M222 296l29-29-38-38-29 29v14h24v24h14zM332 116c-2.25-2.25-6-2-8.25 0.25l-87.5 87.5c-2.25 2.25-2.5 6-0.25 8.25s6 2 8.25-0.25l87.5-87.5c2.25-2.25 2.5-6 0.25-8.25zM352 264.5v47.5c0 39.75-32.25 72-72 72h-208c-39.75 0-72-32.25-72-72v-208c0-39.75 32.25-72 72-72h208c10 0 20 2 29.25 6.25 2.25 1 4 3.25 4.5 5.75 0.5 2.75-0.25 5.25-2.25 7.25l-12.25 12.25c-2.25 2.25-5.25 3-8 2-3.75-1-7.5-1.5-11.25-1.5h-208c-22 0-40 18-40 40v208c0 22 18 40 40 40h208c22 0 40-18 40-40v-31.5c0-2 0.75-4 2.25-5.5l16-16c2.5-2.5 5.75-3 8.75-1.75s5 4 5 7.25zM328 80l72 72-168 168h-72v-72zM439 113l-23 23-72-72 23-23c9.25-9.25 24.75-9.25 34 0l38 38c9.25 9.25 9.25 24.75 0 34z'%3e%3c/path%3e%3c/svg%3e",pe="data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='541' height='512' viewBox='0 0 541 512'%3e %3cpath fill='black' d='M103.306 228.483l129.493-125.249c-17.662-4.272-31.226-18.148-34.98-35.663l-0.055-0.307-129.852 125.248c17.812 4.15 31.53 18.061 35.339 35.662l0.056 0.308z'%3e%3c/path%3e %3cpath fill='black' d='M459.052 393.010c-13.486-8.329-22.346-23.018-22.373-39.779v-0.004c-0.053-0.817-0.082-1.772-0.082-2.733s0.030-1.916 0.089-2.863l-0.007 0.13-149.852 71.94c9.598 8.565 15.611 20.969 15.611 34.779 0 0.014 0 0.029 0 0.043v-0.002c-0.048 5.164-0.94 10.104-2.544 14.711l0.098-0.322z'%3e%3c/path%3e %3cpath fill='black' d='M290.207 57.553c-0.009 15.55-7.606 29.324-19.289 37.819l-0.135 0.093 118.054 46.69c-0.216-1.608-0.346-3.48-0.36-5.379v-0.017c0.033-16.948 9.077-31.778 22.596-39.953l0.209-0.118-122.298-48.056c0.659 2.633 1.098 5.693 1.221 8.834l0.002 0.087z'%3e%3c/path%3e %3cpath fill='black' d='M241.36 410.132l-138.629-160.067c-4.734 17.421-18.861 30.61-36.472 33.911l-0.29 0.045 143.881 166.255c1.668-18.735 14.197-34.162 31.183-40.044l0.327-0.099z'%3e%3c/path%3e %3cpath fill='black' d='M243.446 115.105c-31.785 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.785 0 57.552 25.767 57.552 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM243.446 21.582c-19.866 0-35.97 16.105-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.104-35.97-35.97-35.97v0z'%3e%3c/path%3e %3cpath fill='black' d='M483.224 410.78c-31.786 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.786 0 57.552 25.767 57.552 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM483.224 317.257c-19.866 0-35.97 16.104-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.105-35.97-35.97-35.97v0z'%3e%3c/path%3e %3cpath fill='black' d='M57.553 295.531c-31.785 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.785 0 57.553 25.767 57.553 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM57.553 202.008c-19.866 0-35.97 16.105-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c-0.041-19.835-16.13-35.898-35.97-35.898 0 0 0 0 0 0v0z'%3e%3c/path%3e %3cpath fill='black' d='M256.036 512.072c-31.786 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.786 0 57.553 25.767 57.553 57.553v0c0 31.786-25.767 57.553-57.553 57.553v0zM256.036 418.55c-19.866 0-35.97 16.104-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.105-35.97-35.97-35.97v0z'%3e%3c/path%3e %3cpath fill='black' d='M435.24 194.239c-31.786 0-57.553-25.767-57.553-57.553s25.767-57.553 57.553-57.553c31.786 0 57.553 25.767 57.553 57.553v0c0 31.785-25.767 57.553-57.553 57.553v0zM435.24 100.716c-19.866 0-35.97 16.105-35.97 35.97s16.105 35.97 35.97 35.97c19.866 0 35.97-16.105 35.97-35.97v0c0-19.866-16.105-35.97-35.97-35.97v0z'%3e%3c/path%3e%3c/svg%3e",ve=Object.freeze({__proto__:null,es:{labels:{select:"Seleccionar",addElement:"Modo dibujo",editElement:"Editar elemento",save:"Guardar",delete:"Eliminar",cancel:"Cancelar",apply:"Aplicar cambios",upload:"Subir",editMode:"Modo Edición",confirmDelete:"¿Estás seguro de borrar el elemento?",geomTypeNotSupported:"Geometría no compatible con la capa",editFields:"Editar campos",editGeom:"Editar geometría",selectDrawType:"Tipo de geometría para dibujar",uploadToLayer:"Subir archivo a la capa seleccionada",uploadFeatures:"Subida de elementos a la capa",validFeatures:"Válidas",invalidFeatures:"Invalidas",loading:"Cargando...",toggleVisibility:"Cambiar visibilidad de la capa"},errors:{capabilities:"No se pudieron obtener las Capabilidades del GeoServer",wfst:"El GeoServer no tiene soporte a Transacciones",layer:"No se pudieron obtener datos de la capa",noValidGeometry:"No se encontraron geometrías válidas para agregar a esta capa",geoserver:"No se pudieron obtener datos desde el GeoServer",badFormat:"Formato no soportado",badFile:"Error al leer elementos del archivo",lockFeature:"No se pudieron bloquear elementos en el GeoServer.",transaction:"Error al hacer transacción con el GeoServer. HTTP status:",getFeatures:"Error al obtener elemento desde el GeoServer. HTTP status:"}},en:{labels:{select:"Select",addElement:"Toggle Draw mode",editElement:"Edit feature",save:"Save",delete:"Delete",cancel:"Cancel",apply:"Apply changes",upload:"Upload",editMode:"Edit Mode",confirmDelete:"Are you sure to delete the feature?",geomTypeNotSupported:"Geometry not supported by layer",editFields:"Edit fields",editGeom:"Edit geometry",selectDrawType:"Geometry type to draw",uploadToLayer:"Upload file to selected layer",uploadFeatures:"Uploaded features to layer",validFeatures:"Valid geometries",invalidFeatures:"Invalid",loading:"Loading...",toggleVisibility:"Toggle layer visibility"},errors:{capabilities:"GeoServer Capabilities could not be downloaded.",wfst:"The GeoServer does not support Transactions",layer:"Could not get data from layer",noValidGeometry:"No valid geometries found to add to this layer",geoserver:"Could not get data from the GeoServer",badFormat:"Unsupported format",badFile:"Error reading items from file",lockFeature:"No se pudieron bloquear elementos en el GeoServer. HTTP status:",transaction:"Error when doing Transaction with GeoServer. HTTP status:",getFeatures:"Error getting elements from GeoServer. HTTP status:"}}});function ge(e){return function(e){if(Array.isArray(e))return be(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||_e(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_e(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function _e(e,t){if(e){if("string"==typeof e)return be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?be(e,t):void 0}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ke=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))},Ee="urn:x-ogc:def:crs:EPSG:4326";return function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={geoServerUrl:null,headers:{},layers:null,evtType:"singleclick",active:!0,showControl:!0,useLockFeature:!0,minZoom:9,language:"en",uploadFormats:".geojson,.json,.kml",processUpload:null,beforeInsertFeature:null},this.options=Object.assign(Object.assign({},this.options),r),this._i18n=ve[this.options.language],this._hasLockFeature=!1,this._hasTransaction=!1,this._geoServerCapabilities=null,this._geoServerData={},this.map=t,this.view=t.getView(),this.viewport=t.getViewport(),this._mapLayers=[],this._editedFeatures=new Set,this._layerToInsertElements=this.options.layers[0].name,this._insertFeatures=[],this._updateFeatures=[],this._deleteFeatures=[],this._formatWFS=new S.WFS,this._formatGeoJSON=new S.GeoJSON,this._formatKml=new S.KML({extractStyles:!1,showPointNames:!1}),this._xs=new XMLSerializer,this._isVisible=this.view.getZoom()>this.options.minZoom,this._countRequests=0,this._isEditModeOn=!1,this._initAsyncOperations()}var t,r,n;return t=e,(r=[{key:"_initAsyncOperations",value:function(){return ke(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._createBaseController(),this._showLoading(),e.next=5,this._connectToGeoServerAndGetCapabilities();case 5:if(!this.options.layers){e.next=9;break}return e.next=8,this._getGeoserverLayersData(this.options.layers,this.options.geoServerUrl);case 8:this._createLayers(this.options.layers);case 9:this._initMapElements(this.options.showControl,this.options.active),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),this._hideLoading(),this._showError(e.t0.message);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})))}},{key:"_createBaseController",value:function(){this._controlWidgetToolsDiv=document.createElement("div"),this._controlWidgetToolsDiv.className="ol-wfst--tools-control",this._controlWidgetTools=new k.Control({element:this._controlWidgetToolsDiv}),this.map.addControl(this._controlWidgetTools)}},{key:"_connectToGeoServerAndGetCapabilities",value:function(){return ke(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){return ke(n,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams({service:"wfs",version:"1.3.0",request:"GetCapabilities",exceptions:"application/json"}),r=this.options.geoServerUrl+"?"+t.toString(),e.prev=2,e.next=5,fetch(r,{headers:this.options.headers});case 5:if((n=e.sent).ok){e.next=8;break}throw new Error("");case 8:return e.next=10,n.text();case 10:return o=e.sent,i=(new window.DOMParser).parseFromString(o,"text/xml"),e.abrupt("return",i);case 15:throw e.prev=15,e.t0=e.catch(2),new Error(this._i18n.errors.capabilities);case 18:case"end":return e.stop()}}),e,this,[[2,15]])})))},e.next=3,t();case 3:if(this._geoServerCapabilities=e.sent,r=this._geoServerCapabilities.getElementsByTagName("ows:Operation"),Array.from(r).forEach((function(e){"Transaction"===e.getAttribute("name")?n._hasTransaction=!0:"LockFeature"===e.getAttribute("name")&&(n._hasLockFeature=!0)})),this._hasTransaction){e.next=8;break}throw new Error(this._i18n.errors.wfst);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"_getGeoserverLayersData",value:function(e,t){return ke(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,o,i,a,s,l,c,u,d,h,f=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=function(e){return ke(f,void 0,void 0,regeneratorRuntime.mark((function r(){var n,o,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new URLSearchParams({service:"wfs",version:"2.0.0",request:"DescribeFeatureType",typeNames:e,outputFormat:"application/json",exceptions:"application/json"}),o=t+"?"+n.toString(),r.next=4,fetch(o,{headers:this.options.headers});case 4:if((i=r.sent).ok){r.next=7;break}throw new Error("");case 7:return r.next=9,i.json();case 9:return r.abrupt("return",r.sent);case 10:case"end":return r.stop()}}),r,this)})))},o=ye(e),r.prev=2,o.s();case 4:if((i=o.n()).done){r.next=20;break}return a=i.value,s=a.name,l=a.label||s,r.prev=8,r.next=11,n(s);case 11:(c=r.sent)&&(u=c.targetNamespace,d=c.featureTypes[0].properties,h=d.find((function(e){return e.type.indexOf("gml:")>=0})),this._geoServerData[s]={namespace:u,properties:d,geomType:h.localType,geomField:h.name}),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(8),this._showError("".concat(this._i18n.errors.layer,' "').concat(l,'"'));case 18:r.next=4;break;case 20:r.next=25;break;case 22:r.prev=22,r.t1=r.catch(2),o.e(r.t1);case 25:return r.prev=25,o.f(),r.finish(25);case 28:case"end":return r.stop()}}),r,this,[[2,22,25,28],[8,15]])})))}},{key:"_createLayers",value:function(e){var t,r=this,n=0,o=0,i=function(){++n===o&&r._hideLoading()},a=function(e){var t=e.name,n=e.cqlFilter,o=e.tilesBuffer,a={SERVICE:"WMS",LAYERS:t,TILED:!0};n&&(a.CQL_FILTER=n),o&&(a.BUFFER=o);var s=new F.TileWMS({url:r.options.geoServerUrl,params:a,serverType:"geoserver",tileLoadFunction:function(e,t){return ke(r,void 0,void 0,regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch(t,{headers:this.options.headers});case 3:if((n=r.sent).ok){r.next=6;break}throw new Error("");case 6:return r.next=8,n.blob();case 8:if(void 0===(o=r.sent)){r.next=13;break}e.getImage().src=URL.createObjectURL(o),r.next=14;break;case 13:throw new Error("");case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(0),e.setState(I.default.ERROR);case 19:return r.prev=19,i(),r.finish(19);case 22:case"end":return r.stop()}}),r,this,[[0,16,19,22]])})))}}),l=Object.assign({name:t,type:"_wms_",minZoom:r.options.minZoom,source:s,visible:!0,zIndex:4},e);return new L.Tile(l)},s=function(e){var t=e.name,n=e.cqlFilter,o=e.wfsStrategy||"bbox",a=new F.Vector({format:new S.GeoJSON,strategy:"bbox"===o?T.bbox:T.all,loader:function(e){return ke(r,void 0,void 0,regeneratorRuntime.mark((function r(){var s,l,c,u,d,h;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=new URLSearchParams({service:"wfs",version:"1.0.0",request:"GetFeature",typename:t,outputFormat:"application/json",exceptions:"application/json",srsName:Ee}),n&&s.append("cql_filter",n),"bbox"===o&&(l=O.transformExtent(e,this.view.getProjection().getCode(),Ee),s.append("bbox",l.join(","))),c=this.options.geoServerUrl+"?"+s.toString(),r.prev=4,r.next=7,fetch(c,{headers:this.options.headers});case 7:if((u=r.sent).ok){r.next=10;break}throw new Error("");case 10:return r.next=12,u.json();case 12:d=r.sent,(h=a.getFormat().readFeatures(d,{featureProjection:this.view.getProjection().getCode(),dataProjection:Ee})).forEach((function(e){e.set("_layerName_",t,!0)})),a.addFeatures(h),r.next=23;break;case 18:r.prev=18,r.t0=r.catch(4),this._showError(this._i18n.errors.geoserver),console.error(r.t0),a.removeLoadedExtent(e);case 23:return r.prev=23,i(),r.finish(23);case 26:case"end":return r.stop()}}),r,this,[[4,18,23,26]])})))}}),s=Object.assign({name:t,type:"_wfs_",minZoom:r.options.minZoom,source:a,visible:!0,zIndex:2},e);return new L.Vector(s)},l=ye(e);try{var c=function(){var e=t.value.name;if(r._geoServerData[e]){var n,i=r.options.layers.find((function(t){return t.name===e}));i.mode||(i.mode="wfs"),(n="wfs"===i.mode?s(i):a(i)).getVisible()&&o++,r.map.addLayer(n),r._mapLayers[e]=n}};for(l.s();!(t=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}}},{key:"_initMapElements",value:function(e,t){return ke(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._createEditLayer(),this._addInteractions(),this._addHandlers(),e&&this._addMapControl(),this.activateEditMode(t);case 5:case"end":return r.stop()}}),r,this)})))}},{key:"_addInteractions",value:function(){var e,t=this;this.options.layers.find((function(e){return"wfs"===e.mode}))&&(t.interactionWfsSelect=new E.Select({hitTolerance:10,style:function(e){return t._styleFunction(e)},toggleCondition:j.never,filter:function(e,r){return!t._isEditModeOn&&r&&"_wfs_"===r.get("type")}}),t.map.addInteraction(t.interactionWfsSelect),t.interactionWfsSelect.on("select",(function(e){var r=e.selected,n=e.deselected,o=e.mapBrowserEvent.coordinate;r.length&&r.forEach((function(e){t._editedFeatures.has(String(e.getId()))||(t.interactionWfsSelect.getLayer(e).getSource().removeFeature(e),t._addFeatureToEdit(e,o))})),n.length&&(t._isEditModeOn||n.forEach((function(e){t.interactionSelectModify.getFeatures().remove(e)})))}))),this.options.layers.find((function(e){return"wms"===e.mode}))&&(e=function(e){return ke(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=regeneratorRuntime.mark((function t(r){var n,i,a,s,l,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=o._mapLayers[r]).getVisible()&&"_wms_"===n.get("type")){t.next=3;break}return t.abrupt("return","continue");case 3:return i=e.coordinate,a=o.view.getZoom()>10?10:5,s=n.getSource().getFeatureInfoUrl(i,o.view.getResolution(),o.view.getProjection().getCode(),{INFO_FORMAT:"application/json",BUFFER:a,FEATURE_COUNT:1,EXCEPTIONS:"application/json"}),t.prev=6,t.next=9,fetch(s,{headers:o.options.headers});case 9:if((l=t.sent).ok){t.next=12;break}throw new Error(o._i18n.errors.getFeatures+" "+l.status);case 12:return t.next=14,l.json();case 14:if(c=t.sent,(u=o._formatGeoJSON.readFeatures(c)).length){t.next=18;break}return t.abrupt("return","continue");case 18:u.forEach((function(e){return o._addFeatureToEdit(e,i,r)})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(6),o._showError(t.t0.message);case 24:case"end":return t.stop()}}),t,null,[[6,21]])})),t.t0=regeneratorRuntime.keys(this._mapLayers);case 2:if((t.t1=t.t0()).done){t.next=10;break}return n=t.t1.value,t.delegateYield(r(n),"t2",5);case 5:if("continue"!==t.t2){t.next=8;break}return t.abrupt("continue",2);case 8:t.next=2;break;case 10:case"end":return t.stop()}}),t,this)})))},t._keyClickWms=t.map.on(t.options.evtType,(function(r){return ke(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.map.hasFeatureAtPixel(r.pixel)){t.next=2;break}return t.abrupt("return");case 2:if(this._isVisible){t.next=4;break}return t.abrupt("return");case 4:if(this._isEditModeOn){t.next=7;break}return t.next=7,e(r);case 7:case"end":return t.stop()}}),t,this)})))}))),this.interactionSelectModify=new E.Select({style:function(e){return t._styleFunction(e)},layers:[this._editLayer],toggleCondition:j.never,removeCondition:function(){return!!t._isEditModeOn}}),this.map.addInteraction(this.interactionSelectModify),this.interactionModify=new E.Modify({style:function(){return t._isEditModeOn?new w.Style({image:new w.Circle({radius:6,fill:new w.Fill({color:"#ff0000"}),stroke:new w.Stroke({width:2,color:"rgba(5, 5, 5, 0.9)"})})}):void 0},features:this.interactionSelectModify.getFeatures(),condition:function(e){return j.primaryAction(e)&&t._isEditModeOn}}),this.map.addInteraction(this.interactionModify),this.interactionSnap=new E.Snap({source:this._editLayer.getSource()}),this.map.addInteraction(this.interactionSnap)}},{key:"_createEditLayer",value:function(){var e=this;this._editLayer=new L.Vector({source:new F.Vector,zIndex:5,style:function(t){return e._styleFunction(t)}}),this.map.addLayer(this._editLayer)}},{key:"_addHandlers",value:function(){var e=this;this.interactionModify.on("modifystart",(function(t){e._addFeatureToEditedList(t.features.item(0))})),this._onDeselectFeatureEvent(),this._onRemoveFeatureEvent(),this.map.on("moveend",(function(){e._currentZoom=e.view.getZoom(),e._currentZoom!==e._lastZoom&&(e._currentZoom>e.options.minZoom?e._isVisible||(e._isVisible=!0):e._isVisible&&(e._isVisible=!1)),e._lastZoom=e._currentZoom})),document.addEventListener("keydown",(function(t){var r=t.key;if(!document.querySelector("input:focus")&&"Delete"===r){var n=e.interactionSelectModify.getFeatures();n&&n.forEach((function(t){e._deleteFeature(t,!0)}))}}))}},{key:"_addMapControl",value:function(){var e=this,t=function(){var t=document.createElement("div");if(t.className="wfst--tools-control--head",e.options.showUpload){var r=function(){var t=document.createElement("div"),r=document.createElement("label");r.className="ol-wfst--tools-control-btn ol-wfst--tools-control-btn-upload",r.htmlFor="ol-wfst--upload",r.innerHTML='<img src="'.concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3e%3cpath d='M240 352h-240v128h480v-128h-240zM448 416h-64v-32h64v32zM112 160l128-128 128 128h-80v160h-96v-160z'%3e%3c/path%3e%3c/svg%3e",'"/> '),r.title=e._i18n.labels.uploadToLayer;var n=document.createElement("input");return n.id="ol-wfst--upload",n.type="file",n.accept=e.options.uploadFormats,n.onchange=function(t){return e._processUploadFile(t)},t.append(n),t.append(r),t}();t.append(r)}var n=function(){var t=document.createElement("div");t.className="ol-wfst--tools-control-draw-cnt";var r=document.createElement("button");r.className="ol-wfst--tools-control-btn ol-wfst--tools-control-btn-draw",r.type="button",r.innerHTML='<img src="'.concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e %3cpath d='M663 225l-58.5 58.5-120-120 58.5-58.5q9-9 22.5-9t22.5 9l75 75q9 9 9 22.5t-9 22.5zM96 552l354-354 120 120-354 354h-120v-120z'%3e%3c/path%3e%3c/svg%3e",'"/>'),r.title=e._i18n.labels.addElement,r.onclick=function(){e._isDrawModeOn?(e._resetStateButtons(),e.activateEditMode()):e.activateDrawMode(e._layerToInsertElements)};var n=document.createElement("select");n.title=e._i18n.labels.selectDrawType,n.className="wfst--tools-control--select-draw",n.onchange=function(){var t=n.value;e._changeStateSelect(e._layerToInsertElements,t),e._isDrawModeOn&&e.activateDrawMode(e._layerToInsertElements)};for(var o=0,i=[R,z,D,H,A,W,V];o<i.length;o++){var a=i[o],s=document.createElement("option");s.value=a,s.text=a,s.selected=e._geoServerData[e._layerToInsertElements].geomType===a||!1,n.appendChild(s)}return t.append(r),t.append(n),e._selectDraw=n,t}();return t.append(n),t}();this._controlWidgetToolsDiv.append(t);var r=function(){var t="";Object.keys(e._mapLayers).map((function(r){return t+=(n=e.options.layers.find((function(e){return e.name===r})),o=n.name,i='<span title="'.concat(e._geoServerData[o].geomType,'">').concat(n.label||o,"</span>"),a=!("visible"in n)||n.visible,'\n                <div class="wfst--layer-control \n                    '.concat(a?"ol-wfst--visible-on":"","\n                    ").concat(o===e._layerToInsertElements?"ol-wfst--selected-on":"",'\n                    " data-layer="').concat(o,'">\n                    <div class="ol-wfst--tools-control-visible">\n                    <span class="ol-wfst--tools-control-visible-btn ol-wfst--visible-btn-on" title="').concat(e._i18n.labels.toggleVisibility,'">\n                      <img src="').concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e%3cpath d='M384 288q39 0 67.5 28.5t28.5 67.5-28.5 67.5-67.5 28.5-67.5-28.5-28.5-67.5 28.5-67.5 67.5-28.5zM384 544.5q66 0 113.25-47.25t47.25-113.25-47.25-113.25-113.25-47.25-113.25 47.25-47.25 113.25 47.25 113.25 113.25 47.25zM384 144q118.5 0 214.5 66t138 174q-42 108-138 174t-214.5 66-214.5-66-138-174q42-108 138-174t214.5-66z'%3e%3c/path%3e%3c/svg%3e",'"/>\n                    </span>\n                    <span class="ol-wfst--tools-control-visible-btn ol-wfst--visible-btn-off" title="').concat(e._i18n.labels.toggleVisibility,'">\n                      <img src="').concat("data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e%3cpath d='M379.5 288h4.5q39 0 67.5 28.5t28.5 67.5v6zM241.5 313.5q-18 36-18 70.5 0 66 47.25 113.25t113.25 47.25q34.5 0 70.5-18l-49.5-49.5q-12 3-21 3-39 0-67.5-28.5t-28.5-67.5q0-9 3-21zM64.5 136.5l40.5-40.5 567 567-40.5 40.5q-7.5-7.5-47.25-46.5t-60.75-60q-64.5 27-139.5 27-118.5 0-214.5-66t-138-174q16.5-39 51.75-86.25t68.25-72.75q-18-18-50.25-51t-36.75-37.5zM384 223.5q-30 0-58.5 12l-69-69q58.5-22.5 127.5-22.5 118.5 0 213.75 66t137.25 174q-36 88.5-109.5 151.5l-93-93q12-28.5 12-58.5 0-66-47.25-113.25t-113.25-47.25z'%3e%3c/path%3e%3c/svg%3e",'"/>\n                    </span>\n                  </div>\n                    <label for="wfst--').concat(o,'">\n                        <input value="').concat(o,'" id="wfst--').concat(o,'" type="radio" class="ol-wfst--tools-control-input" name="wfst--select-layer" ').concat(o===e._layerToInsertElements?'checked="checked"':"",">\n                        ").concat(i,"\n                    </label>\n                </div>"));var n,o,i,a}));var r=document.createElement("div");return r.className="wfst--tools-control--select-layers",r.innerHTML=t,r.querySelectorAll("input").forEach((function(t){var n=t.closest(".wfst--layer-control");t.onchange=function(){var o=r.querySelector(".ol-wfst--selected-on");o&&o.classList.remove("ol-wfst--selected-on"),n.classList.add("ol-wfst--selected-on"),e._layerToInsertElements=t.value,e._changeStateSelect(e._layerToInsertElements)}})),r.querySelectorAll(".ol-wfst--tools-control-visible-btn").forEach((function(t){var r=t.closest(".wfst--layer-control"),n=r.dataset.layer;t.onclick=function(){r.classList.toggle("ol-wfst--visible-on");var t=e._mapLayers[n];r.classList.contains("ol-wfst--visible-on")?t.setVisible(!0):t.setVisible(!1)}})),r}();this._controlWidgetToolsDiv.append(r)}},{key:"_showLoading",value:function(){this._modalLoading||(this._modalLoading=document.createElement("div"),this._modalLoading.className="ol-wfst--tools-control--loading",this._modalLoading.innerHTML=this._i18n.labels.loading,this._controlWidgetToolsDiv.append(this._modalLoading)),this._modalLoading.classList.add("ol-wfst--tools-control--loading-show")}},{key:"_hideLoading",value:function(){this._modalLoading.classList.remove("ol-wfst--tools-control--loading-show")}},{key:"_lockFeature",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ke(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,i,a,s,l,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=new URLSearchParams({service:"wfs",version:"1.1.0",request:"LockFeature",expiry:String(5),LockId:"GeoServer",typeName:t,releaseAction:"SOME",exceptions:"application/json",featureid:"".concat(e)}),i=this.options.geoServerUrl+"?"+o.toString(),n.prev=2,n.next=5,fetch(i,{headers:this.options.headers});case 5:if((a=n.sent).ok){n.next=8;break}throw new Error(this._i18n.errors.lockFeature);case 8:return n.next=10,a.text();case 10:s=n.sent;try{"exceptions"in(l=JSON.parse(s))&&("CannotLockAllFeatures"===(c=l.exceptions)[0].code?r?this._showError(this._i18n.errors.lockFeature):this._lockFeature(e,t,1):this._showError(c[0].text))}catch(e){}return n.abrupt("return",s);case 15:n.prev=15,n.t0=n.catch(2),this._showError(n.t0.message);case 18:case"end":return n.stop()}}),n,this,[[2,15]])})))}},{key:"_showError",value:function(e){fe.alert("Error: "+e,{animateInClass:"in"}).show()}},{key:"_transactWFS",value:function(e,t,r){return ke(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,i,a,s,l,c,u,d,h,f,m,p,v,g=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=function(e,t){var r=M.fromCircle(t);e.setGeometry(r)},i=function(e,t){var r=t.getGeometries()[0];r.getType()===V&&(r=M.fromCircle(r)),e.setGeometry(r)},t=Array.isArray(t)?t:[t],a=function(e){g._removeFeatureFromEditList(e);var t=e.getProperties();delete t.boundedBy,delete t._layerName_;var r=new x.Feature(t);return r.setId(e.getId()),r},s=function(e){var t=e.getSource();t.refresh();var r=t.getParams();r.t=(new Date).getMilliseconds(),t.updateParams(r)},l=function(e){e.getSource().refresh()},c=[],u=ye(t);try{for(u.s();!(d=u.n()).done;)h=d.value,f=a(h),m=f.getGeometry(),(p=m.getType())===U?i(f,m):p===V&&o(f,m),"insert"===e&&this.options.beforeInsertFeature&&(f=this.options.beforeInsertFeature(f)),f&&c.push(f)}catch(e){u.e(e)}finally{u.f()}if(c.length){n.next=11;break}return n.abrupt("return",this._showError(this._i18n.errors.noValidGeometry));case 11:n.t0=e,n.next="insert"===n.t0?14:"update"===n.t0?16:"delete"===n.t0?18:20;break;case 14:return this._insertFeatures=[].concat(ge(this._insertFeatures),c),n.abrupt("break",21);case 16:return this._updateFeatures=[].concat(ge(this._updateFeatures),c),n.abrupt("break",21);case 18:return this._deleteFeatures=[].concat(ge(this._deleteFeatures),c),n.abrupt("break",21);case 20:return n.abrupt("break",21);case 21:this._countRequests++,v=this._countRequests,setTimeout((function(){return ke(g,void 0,void 0,regeneratorRuntime.mark((function n(){var o,i,a,c,u,d,h,f,m,p,g,y,_,b,w,k,E;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(v===this._countRequests){n.next=2;break}return n.abrupt("return");case 2:return o="EPSG:4326"===(o=this.view.getProjection().getCode())?Ee:o,i={featureNS:this._geoServerData[r].namespace,featureType:r,srsName:o,featurePrefix:null,nativeElements:null},a=this._formatWFS.writeTransaction(this._insertFeatures,this._updateFeatures,this._deleteFeatures,i),c=this._xs.serializeToString(a),u=this._geoServerData[r].geomType,d=this._geoServerData[r].geomField,u===U&&("insert"===e?c=(c=c.replace(/<geometry>/g,'<geometry><MultiGeometry xmlns="http://www.opengis.net/gml" srsName="'.concat(o,'"><geometryMember>'))).replace(/<\/geometry>/g,"</geometryMember></MultiGeometry></geometry>"):"update"===e&&(h='<MultiGeometry xmlns="http://www.opengis.net/gml" srsName="'.concat(o,'"><geometryMember>'),c=c.replace(/(.*)(<Name>geometry<\/Name><Value>)(.*?)(<\/Value>)(.*)/g,"$1$2".concat(h,"$3").concat("</geometryMember></MultiGeometry>","$4$5")))),c="insert"===e?c.replace(/<(\/?)\bgeometry\b>/g,"<$1".concat(d,">")):c.replace(/<Name>geometry<\/Name>/g,"<Name>".concat(d,"</Name>")),this._hasLockFeature&&this._useLockFeature&&"insert"!==e&&(c=c.replace("</Transaction>","<LockId>GeoServer</LockId></Transaction>")),n.prev=12,f=Object.assign({"Content-Type":"text/xml"},this.options.headers),n.next=16,fetch(this.options.geoServerUrl,{method:"POST",body:c,headers:f});case 16:if((m=n.sent).ok){n.next=19;break}throw new Error(this._i18n.errors.transaction+" "+m.status);case 19:if(p=this._formatWFS.readTransactionResponse(m),Object.keys(p).length){n.next=26;break}return n.next=23,m.text();case 23:g=n.sent,(y=String(g).match(/<ows:ExceptionText>([\s\S]*?)<\/ows:ExceptionText>/))&&this._showError(y[1]);case 26:if("delete"!==e){_=ye(t);try{for(_.s();!(b=_.n()).done;)w=b.value,this._editLayer.getSource().removeFeature(w)}catch(e){_.e(e)}finally{_.f()}}k=this.options.layers.find((function(e){return e.name===r})),"wfs"===(E=k.mode)?l(this._mapLayers[r]):"wms"===E&&s(this._mapLayers[r]),this._hideLoading(),n.next=35;break;case 32:n.prev=32,n.t0=n.catch(12),console.error(n.t0);case 35:this._insertFeatures=[],this._updateFeatures=[],this._deleteFeatures=[],this._countRequests=0;case 39:case"end":return n.stop()}}),n,this,[[12,32]])})))}),0);case 24:case"end":return n.stop()}}),n,this)})))}},{key:"_addFeatureToEditedList",value:function(e){this._editedFeatures.add(String(e.getId()))}},{key:"_removeFeatureFromEditList",value:function(e){this._editedFeatures.delete(String(e.getId()))}},{key:"_isFeatureEdited",value:function(e){return this._editedFeatures.has(String(e.getId()))}},{key:"_deselectEditFeature",value:function(e){this._removeOverlayHelper(e)}},{key:"_restoreFeatureToLayer",value:function(e,t){t=t||e.get("_layerName_"),this._mapLayers[t].getSource().addFeature(e)}},{key:"_removeFeatureFromTmpLayer",value:function(e){this._editLayer.getSource().removeFeature(e)}},{key:"_onDeselectFeatureEvent",value:function(){var e=this;this._keySelect=this.interactionSelectModify.getFeatures().on("remove",(function(t){var r=t.element;e._deselectEditFeature(r),function(t){var r=t.get("_layerName_"),n=e.options.layers.find((function(e){return e.name===r})).mode;"wfs"===n&&e.interactionWfsSelect.getFeatures().remove(t),e._isFeatureEdited(t)?e._transactWFS("update",t,r):("wfs"===n&&e._restoreFeatureToLayer(t,r),e._removeFeatureFromTmpLayer(t))}(r),e._editModeOff()}))}},{key:"_onRemoveFeatureEvent",value:function(){var e=this;this._keyRemove=this._editLayer.getSource().on("removefeature",(function(t){var r=t.feature;if(r.get("_delete_")){e._keySelect&&q.unByKey(e._keySelect);var n=r.get("_layerName_");e._transactWFS("delete",r,n),e._deselectEditFeature(r),e._editModeOff(),e._keySelect&&setTimeout((function(){e._onDeselectFeatureEvent()}),150)}}))}},{key:"_styleFunction",value:function(e){var t=function(e){var t=e.getGeometry(),r=t.getType();r===U&&(r=(t=t.getGeometries()[0]).getType());var n=t.getCoordinates(),o=null;if(r===A||r===H?o=n.flat(1):r===W&&(o=n.flat(2)),o&&o.length)return new b.MultiPoint(o)},r=e.getGeometry(),n=r.getType();switch(n===U&&(n=(r=r.getGeometries()[0]).getType()),n){case"Point":case"MultiPoint":return this._isEditModeOn?[new w.Style({image:new w.Circle({radius:6,fill:new w.Fill({color:"#000000"})})}),new w.Style({image:new w.Circle({radius:4,fill:new w.Fill({color:"#ff0000"})})})]:[new w.Style({image:new w.Circle({radius:5,fill:new w.Fill({color:"#ff0000"})})}),new w.Style({image:new w.Circle({radius:2,fill:new w.Fill({color:"#000000"})})})];default:return this._isEditModeOn||this._isDrawModeOn?[new w.Style({stroke:new w.Stroke({color:"rgba( 255, 0, 0, 1)",width:4}),fill:new w.Fill({color:"rgba(255, 0, 0, 0.7)"})}),new w.Style({image:new w.Circle({radius:4,fill:new w.Fill({color:"#ff0000"}),stroke:new w.Stroke({width:2,color:"rgba(5, 5, 5, 0.9)"})}),geometry:function(e){return t(e)}}),new w.Style({stroke:new w.Stroke({color:"rgba(255, 255, 255, 0.7)",width:2})})]:[new w.Style({image:new w.Circle({radius:2,fill:new w.Fill({color:"#000000"})}),geometry:function(e){return t(e)}}),new w.Style({stroke:new w.Stroke({color:"#ff0000",width:4}),fill:new w.Fill({color:"rgba(255, 0, 0, 0.7)"})})]}}},{key:"_editModeOn",value:function(e){var t=this;this._editFeatureOriginal=e.clone(),this._isEditModeOn=!0,this._editLayer.getSource().changed(),this._removeOverlayHelper(e);var r=document.createElement("div");r.className="ol-wfst--changes-control";var n=document.createElement("div");n.className="ol-wfst--changes-control-el";var o=document.createElement("div");o.className="ol-wfst--changes-control-id",o.innerHTML="<b>".concat(this._i18n.labels.editMode,"</b> - <i>").concat(String(e.getId()),"</i>");var i=document.createElement("button");i.type="button",i.textContent=this._i18n.labels.apply,i.className="btn btn-primary",i.onclick=function(){t._showLoading(),t.interactionSelectModify.getFeatures().remove(e)};var a=document.createElement("button");a.type="button",a.textContent=this._i18n.labels.cancel,a.className="btn btn-secondary",a.onclick=function(){e.setGeometry(t._editFeatureOriginal.getGeometry()),t._removeFeatureFromEditList(e),t.interactionSelectModify.getFeatures().remove(e)},n.append(o),n.append(a),n.append(i),r.append(n),this._controlApplyDiscardChanges=new k.Control({element:r}),this.map.addControl(this._controlApplyDiscardChanges)}},{key:"_editModeOff",value:function(){this._isEditModeOn=!1,this.map.removeControl(this._controlApplyDiscardChanges)}},{key:"_deleteFeature",value:function(e,t){var r=this,n=function(){(Array.isArray(e)?e:[e]).forEach((function(e){e.set("_delete_",!0,!0),r._editLayer.getSource().removeFeature(e)})),r.interactionSelectModify.getFeatures().clear();var t=e.get("_layerName_");"wfs"===r.options.layers.find((function(e){return e.name===t})).mode&&r.interactionWfsSelect.getFeatures().remove(e)};t?fe.confirm(this._i18n.labels.confirmDelete,{animateInClass:"in"}).show().once("dismiss",(function(e,t,r){r&&r.value&&n()})):n()}},{key:"_addFeatureToEdit",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=function(){var n='<img src="'.concat(me,'"/>'),o=document.createElement("div");o.className="ol-wfst--edit-button-cnt",o.innerHTML='<button class="ol-wfst--edit-button" type="button" title="'.concat(t._i18n.labels.editFields,'">').concat(n,"</button>"),o.onclick=function(){t._initEditFieldsModal(e)};var i=document.createElement("div");i.append(o);var a='<img src="'.concat(pe,'"/>'),s=document.createElement("div");s.className="ol-wfst--edit-button-cnt",s.innerHTML='<button class="ol-wfst--edit-button" type="button" title="'.concat(t._i18n.labels.editGeom,'">').concat(a,"</button>"),s.onclick=function(){t._editModeOn(e)},i.append(s);var l=r||C.getCenter(e.getGeometry().getExtent()),c=new x.Overlay({id:e.getId(),position:l,positioning:B,element:i,offset:[0,-40],stopEvent:!0});t.map.addOverlay(c)};n&&e.set("_layerName_",n);var i=e?e.getProperties():"";i&&e.getGeometry()&&(this._editLayer.getSource().addFeature(e),this.interactionSelectModify.getFeatures().push(e),o(),this._useLockFeature&&this._hasLockFeature&&this._lockFeature(e.getId(),e.get("_layerName_")))}},{key:"_resetStateButtons",value:function(){var e=document.querySelector(".ol-wfst--tools-control-btn.wfst--active");e&&e.classList.remove("wfst--active")}},{key:"_initUploadFileModal",value:function(e,t){var r=this,n='\n            <button type="button" class="btn btn-secondary" data-dismiss="modal">\n                '.concat(this._i18n.labels.cancel,'\n            </button>\n            <button type="button" class="btn btn-primary" data-action="save" data-dismiss="modal">\n                ').concat(this._i18n.labels.upload,"\n            </button>\n        ");new fe({header:!0,headerClose:!1,title:this._i18n.labels.uploadFeatures+" "+this._layerToInsertElements,content:e,backdrop:"static",footer:n,animateInClass:"in"}).show().on("dismiss",(function(e,n){"save"===n.target.dataset.action?r._transactWFS("insert",t,r._layerToInsertElements):r._editLayer.getSource().clear()}))}},{key:"_processUploadFile",value:function(e){return ke(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,o,i,a,s,l,c,u,d,h,f,m,p,v=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=function(e){return new Promise((function(t,r){var n=new FileReader;n.addEventListener("load",(function(e){return ke(v,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.target.result,t(n);case 2:case"end":return r.stop()}}),r)})))})),n.addEventListener("error",(function(e){console.error("Error"+e),r()})),n.readAsText(e)}))},n=function(e){var t,r=v._geoServerData[v._layerToInsertElements].geomType;switch(e.getGeometry().getType()){case"Point":if("MultiPoint"===r){var n=e.getGeometry().getCoordinates();t=new b.MultiPoint([n])}break;case"LineString":if("MultiLineString"===r){var o=e.getGeometry().getCoordinates();t=new b.MultiLineString([o])}break;case"Polygon":if("MultiPolygon"===r){var i=e.getGeometry().getCoordinates();t=new b.MultiPolygon([i])}break;default:t=null}return t?(e.setGeometry(t),e):null},o=function(e){var t=v._geoServerData[v._layerToInsertElements].geomType,r=e.getGeometry().getType();return t===U||r===t},i=e.target.files[0]){t.next=6;break}return t.abrupt("return");case 6:if(s=i.name.split(".").pop().toLowerCase(),t.prev=7,this.options.processUpload&&(a=this.options.processUpload(i)),a){t.next=14;break}return t.next=12,r(i);case 12:l=t.sent,"geojson"===s||"json"===s?a=this._formatGeoJSON.readFeatures(l,{featureProjection:this.view.getProjection().getCode()}):"kml"===s?a=this._formatKml.readFeatures(l,{featureProjection:this.view.getProjection().getCode()}):this._showError(this._i18n.errors.badFormat);case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(7),this._showError(this._i18n.errors.badFile);case 19:c=0,u=0,d=[],h=ye(a),t.prev=23,h.s();case 25:if((f=h.n()).done){t.next=37;break}if(m=f.value,o(m)||(m=n(m)),!m){t.next=33;break}d.push(m),u++,t.next=35;break;case 33:return c++,t.abrupt("continue",35);case 35:t.next=25;break;case 37:t.next=42;break;case 39:t.prev=39,t.t1=t.catch(23),h.e(t.t1);case 42:return t.prev=42,h.f(),t.finish(42);case 45:u?(this._resetStateButtons(),this.activateEditMode(),p="\n                ".concat(this._i18n.labels.validFeatures,": ").concat(u,"<br>\n                ").concat(c?"".concat(this._i18n.labels.invalidFeatures,": ").concat(c):"","\n            "),this._initUploadFileModal(p,d),this._editLayer.getSource().addFeatures(d),this.view.fit(this._editLayer.getSource().getExtent(),{size:this.map.getSize(),maxZoom:21,padding:[100,100,100,100]})):this._showError(this._i18n.errors.noValidGeometry),e.target.value=null;case 47:case"end":return t.stop()}}),t,this,[[7,16],[23,39,42,45]])})))}},{key:"_changeStateSelect",value:function(e){var t,r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=function(e,t){Array.from(r._selectDraw.options).forEach((function(n){n.selected=n.value===e,n.disabled="all"!==t&&!t.includes(n.value),n.title=n.disabled?r._i18n.labels.geomTypeNotSupported:""}))};if(this._selectDraw){var i=this._geoServerData[e].geomType;n?t=this._selectDraw.value:i===U?o(t=D,"all"):i===P?(o(t=D,[V,P,A]),this._selectDraw.value=t):o(t=i,[i])}return t}},{key:"activateDrawMode",value:function(e){var t=this;if(this.interactionDraw||e){if(e){if(!this._mapLayers[e].getVisible())return;var r=document.querySelector(".ol-wfst--tools-control-btn-draw");r&&r.classList.add("wfst--active"),this.viewport.classList.add("draw-mode"),function(e){t.activateEditMode(!1),t.interactionDraw&&t.map.removeInteraction(t.interactionDraw);var r=t._selectDraw.value;t.interactionDraw=new E.Draw({source:t._editLayer.getSource(),type:r,style:function(e){return t._styleFunction(e)}}),t.map.addInteraction(t.interactionDraw),t.interactionDraw.on("drawend",(function(r){var n=r.feature;t._transactWFS("insert",n,e)}))}(String(e))}else this.map.removeInteraction(this.interactionDraw),this.viewport.classList.remove("draw-mode");this._isDrawModeOn=!!e}}},{key:"activateEditMode",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e){var t=document.querySelector(".ol-wfst--tools-control-btn-edit");t&&t.classList.add("wfst--active"),this.activateDrawMode(!1)}else this.interactionSelectModify.getFeatures().clear();this.interactionSelectModify.setActive(e),this.interactionModify.setActive(e),this.interactionWfsSelect.setActive(e)}},{key:"insertFeaturesTo",value:function(e,t){this._transactWFS("insert",t,e)}},{key:"_initEditFieldsModal",value:function(e){var t=this;this._editFeature=e;var r=e.getProperties(),n=e.get("_layerName_"),o=this._geoServerData[n].properties,i='<form autocomplete="false">';Object.keys(r).forEach((function(e){var t=o.find((function(t){return t.name===e}));if(t){var n;switch(t.type){case"xsd:string":n="text";break;case"xsd:number":case"xsd:int":n="number";break;case"xsd:date-time":n="datetime";break;default:n="text"}n&&(i+='\n                <div class="ol-wfst--input-field-container">\n                    <label class="ol-wfst--input-field-label" for="'.concat(e,'">').concat(e,'</label>\n                    <input placeholder="NULL" class="ol-wfst--input-field-input" type="').concat(n,'" name="').concat(e,'" value="').concat(r[e]||"",'">\n                </div>'))}})),i+="</form>";var a='\n            <button type="button" class="btn btn-link btn-third" data-action="delete" data-dismiss="modal">\n                '.concat(this._i18n.labels.delete,'\n            </button>\n            <button type="button" class="btn btn-secondary" data-dismiss="modal">\n                ').concat(this._i18n.labels.cancel,'\n            </button>\n            <button type="button" class="btn btn-primary" data-action="save" data-dismiss="modal">\n                ').concat(this._i18n.labels.save,"\n            </button>\n        ");new fe({header:!0,headerClose:!0,title:"".concat(this._i18n.labels.editElement," ").concat(this._editFeature.getId()," "),content:i,footer:a,animateInClass:"in"}).show().on("dismiss",(function(e,r){"save"===r.target.dataset.action?(e.el.querySelectorAll("input").forEach((function(e){var r=e.value,n=e.name;t._editFeature.set(n,r,!0)})),t._editFeature.changed(),t._addFeatureToEditedList(t._editFeature),t.interactionSelectModify.getFeatures().remove(t._editFeature)):"delete"===r.target.dataset.action&&t._deleteFeature(t._editFeature,!0)}))}},{key:"_removeOverlayHelper",value:function(e){var t=e.getId();if(t){var r=this.map.getOverlayById(t);r&&this.map.removeOverlay(r)}}}])&&we(t.prototype,r),n&&we(t,n),e}()}));
